<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Modern web application for browsing and streaming Stash media content with real-time HLS transcoding"><meta name=author content=carrotwaxr><link href=https://carrotwaxr.github.io/peek-stash-browser/plans/2025-12-10-sqlite-architecture-refactor/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>SQLite Architecture Refactor Implementation Plan - Peek Stash Browser</title><link rel=stylesheet href=../../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=pink> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#sqlite-architecture-refactor-implementation-plan class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Peek Stash Browser" class="md-header__button md-logo" aria-label="Peek Stash Browser" data-md-component=logo> <img src=../../assets/peek-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Peek Stash Browser </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SQLite Architecture Refactor Implementation Plan </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=pink aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=pink aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/carrotwaxr/peek-stash-browser title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> carrotwaxr/peek-stash-browser </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../user-guide/custom-carousels/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../development/content-restrictions/ class=md-tabs__link> Development </a> </li> <li class=md-tabs__item> <a href=../../reference/troubleshooting/ class=md-tabs__link> Reference </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Peek Stash Browser" class="md-nav__button md-logo" aria-label="Peek Stash Browser" data-md-component=logo> <img src=../../assets/peek-logo.png alt=logo> </a> Peek Stash Browser </label> <div class=md-nav__source> <a href=https://github.com/carrotwaxr/peek-stash-browser title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> carrotwaxr/peek-stash-browser </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/upgrading/ class=md-nav__link> <span class=md-ellipsis> Upgrading </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/custom-carousels/ class=md-nav__link> <span class=md-ellipsis> Custom Carousels </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/watch-history/ class=md-nav__link> <span class=md-ellipsis> Watch History </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/keyboard-navigation/ class=md-nav__link> <span class=md-ellipsis> Keyboard Navigation </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/playlists/ class=md-nav__link> <span class=md-ellipsis> Playlists </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/hidden-items/ class=md-nav__link> <span class=md-ellipsis> Hidden Items </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/external-player/ class=md-nav__link> <span class=md-ellipsis> External Player </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../development/content-restrictions/ class=md-nav__link> <span class=md-ellipsis> Content Restrictions System </span> </a> </li> <li class=md-nav__item> <a href=../../development/regression-testing/ class=md-nav__link> <span class=md-ellipsis> Regression Testing Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../../reference/faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#session-1-schema-migration class=md-nav__link> <span class=md-ellipsis> Session 1: Schema + Migration </span> </a> <nav class=md-nav aria-label="Session 1: Schema + Migration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#task-1-delete-old-cache-migrations class=md-nav__link> <span class=md-ellipsis> Task 1: Delete Old Cache Migrations </span> </a> </li> <li class=md-nav__item> <a href=#task-2-update-prisma-schema-rename-tables class=md-nav__link> <span class=md-ellipsis> Task 2: Update Prisma Schema - Rename Tables </span> </a> </li> <li class=md-nav__item> <a href=#task-3-update-prisma-schema-add-tag-junction-tables class=md-nav__link> <span class=md-ellipsis> Task 3: Update Prisma Schema - Add Tag Junction Tables </span> </a> </li> <li class=md-nav__item> <a href=#task-4-update-prisma-schema-remove-denormalized-count-fields class=md-nav__link> <span class=md-ellipsis> Task 4: Update Prisma Schema - Remove Denormalized Count Fields </span> </a> </li> <li class=md-nav__item> <a href=#task-5-update-prisma-schema-remove-tagids-json-fields class=md-nav__link> <span class=md-ellipsis> Task 5: Update Prisma Schema - Remove tagIds JSON Fields </span> </a> </li> <li class=md-nav__item> <a href=#task-6-update-prisma-schema-remove-deprecated-data-field class=md-nav__link> <span class=md-ellipsis> Task 6: Update Prisma Schema - Remove Deprecated data Field </span> </a> </li> <li class=md-nav__item> <a href=#task-7-create-squashed-migration-file class=md-nav__link> <span class=md-ellipsis> Task 7: Create Squashed Migration File </span> </a> </li> <li class=md-nav__item> <a href=#task-8-verify-prisma-schema-consistency class=md-nav__link> <span class=md-ellipsis> Task 8: Verify Prisma Schema Consistency </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#session-2-server-code-refactor class=md-nav__link> <span class=md-ellipsis> Session 2: Server Code Refactor </span> </a> <nav class=md-nav aria-label="Session 2: Server Code Refactor"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#task-9-rename-pathmappingts-to-stashurlproxyts class=md-nav__link> <span class=md-ellipsis> Task 9: Rename pathMapping.ts to stashUrlProxy.ts </span> </a> </li> <li class=md-nav__item> <a href=#task-10-update-cachedentityqueryservice-rename-to-stashentityservice class=md-nav__link> <span class=md-ellipsis> Task 10: Update CachedEntityQueryService - Rename to StashEntityService </span> </a> </li> <li class=md-nav__item> <a href=#task-11-update-stashsyncservice-table-references class=md-nav__link> <span class=md-ellipsis> Task 11: Update StashSyncService - Table References </span> </a> </li> <li class=md-nav__item> <a href=#task-12-update-scenequerybuilder-table-references class=md-nav__link> <span class=md-ellipsis> Task 12: Update SceneQueryBuilder - Table References </span> </a> </li> <li class=md-nav__item> <a href=#task-13-update-userrestrictionservice-table-references class=md-nav__link> <span class=md-ellipsis> Task 13: Update UserRestrictionService - Table References </span> </a> </li> <li class=md-nav__item> <a href=#task-14-update-stashcachemanager-table-references class=md-nav__link> <span class=md-ellipsis> Task 14: Update StashCacheManager - Table References </span> </a> </li> <li class=md-nav__item> <a href=#task-15-update-library-controllers-import-changes class=md-nav__link> <span class=md-ellipsis> Task 15: Update Library Controllers - Import Changes </span> </a> </li> <li class=md-nav__item> <a href=#task-16-update-other-services-and-controllers class=md-nav__link> <span class=md-ellipsis> Task 16: Update Other Services and Controllers </span> </a> </li> <li class=md-nav__item> <a href=#task-17-update-tests-table-and-service-references class=md-nav__link> <span class=md-ellipsis> Task 17: Update Tests - Table and Service References </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#session-3-client-updates class=md-nav__link> <span class=md-ellipsis> Session 3: Client Updates </span> </a> <nav class=md-nav aria-label="Session 3: Client Updates"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#task-18-rename-cacheloadingbanner-to-syncprogressbanner class=md-nav__link> <span class=md-ellipsis> Task 18: Rename CacheLoadingBanner to SyncProgressBanner </span> </a> </li> <li class=md-nav__item> <a href=#task-19-update-client-terminology-cache-to-library class=md-nav__link> <span class=md-ellipsis> Task 19: Update Client Terminology - Cache to Library </span> </a> </li> <li class=md-nav__item> <a href=#task-20-run-linting-and-fix-issues class=md-nav__link> <span class=md-ellipsis> Task 20: Run Linting and Fix Issues </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#session-4-testing-and-documentation class=md-nav__link> <span class=md-ellipsis> Session 4: Testing and Documentation </span> </a> <nav class=md-nav aria-label="Session 4: Testing and Documentation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#task-21-delete-local-database-and-test-fresh-install class=md-nav__link> <span class=md-ellipsis> Task 21: Delete Local Database and Test Fresh Install </span> </a> </li> <li class=md-nav__item> <a href=#task-22-run-all-tests class=md-nav__link> <span class=md-ellipsis> Task 22: Run All Tests </span> </a> </li> <li class=md-nav__item> <a href=#task-23-update-readme-documentation class=md-nav__link> <span class=md-ellipsis> Task 23: Update README Documentation </span> </a> </li> <li class=md-nav__item> <a href=#task-24-final-verification-and-cleanup class=md-nav__link> <span class=md-ellipsis> Task 24: Final Verification and Cleanup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=sqlite-architecture-refactor-implementation-plan>SQLite Architecture Refactor Implementation Plan<a class=headerlink href=#sqlite-architecture-refactor-implementation-plan title="Permanent link">&para;</a></h1> <blockquote> <p><strong>For Claude:</strong> REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.</p> </blockquote> <p><strong>Goal:</strong> Refactor from incremental migrations to a clean single migration with table renames (Cached* -&gt; Stash*), add missing junction tables for tags, remove denormalized counts, standardize on rating100, and rename pathMapping.ts to stashUrlProxy.ts.</p> <p><strong>Architecture:</strong> Squash 6 existing cache migrations into one clean migration that creates all Stash* tables, junction tables, and FTS5 search. Update all services to reference new table names. Normalize counts (computed via JOINs instead of stored). Keep URL proxy utility but rename it for clarity.</p> <p><strong>Tech Stack:</strong> Prisma 6, SQLite, TypeScript, Vitest, Express</p> <hr> <h2 id=session-1-schema-migration>Session 1: Schema + Migration<a class=headerlink href=#session-1-schema-migration title="Permanent link">&para;</a></h2> <h3 id=task-1-delete-old-cache-migrations>Task 1: Delete Old Cache Migrations<a class=headerlink href=#task-1-delete-old-cache-migrations title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Delete: <code>server/prisma/migrations/20251208160610_add_cached_entities/</code> - Delete: <code>server/prisma/migrations/20251208160700_add_fts5_search/</code> - Delete: <code>server/prisma/migrations/20251209000000_eliminate_json_blob/</code> - Delete: <code>server/prisma/migrations/20251209100000_remove_junction_fk_constraints/</code> - Delete: <code>server/prisma/migrations/20251209150000_add_entity_tags_and_gallery_performers/</code> - Delete: <code>server/prisma/migrations/20251210180000_add_missing_entity_count_fields/</code></p> <p><strong>Step 1: Delete the migration directories</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>rm<span class=w> </span>-rf<span class=w> </span>server/prisma/migrations/20251208160610_add_cached_entities
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>rm<span class=w> </span>-rf<span class=w> </span>server/prisma/migrations/20251208160700_add_fts5_search
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>rm<span class=w> </span>-rf<span class=w> </span>server/prisma/migrations/20251209000000_eliminate_json_blob
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>rm<span class=w> </span>-rf<span class=w> </span>server/prisma/migrations/20251209100000_remove_junction_fk_constraints
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>rm<span class=w> </span>-rf<span class=w> </span>server/prisma/migrations/20251209150000_add_entity_tags_and_gallery_performers
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>rm<span class=w> </span>-rf<span class=w> </span>server/prisma/migrations/20251210180000_add_missing_entity_count_fields
</span></code></pre></div> <p><strong>Step 2: Verify deletions</strong></p> <p>Run: <code>ls server/prisma/migrations/</code> Expected: Only <code>0_baseline/</code> and <code>20251126202944_add_user_carousel/</code> remain</p> <p><strong>Step 3: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;chore: remove incremental cache migrations for squash&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-2-update-prisma-schema-rename-tables>Task 2: Update Prisma Schema - Rename Tables<a class=headerlink href=#task-2-update-prisma-schema-rename-tables title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/prisma/schema.prisma</code></p> <p><strong>Step 1: Rename CachedScene to StashScene</strong></p> <p>Find all occurrences of <code>CachedScene</code> and replace with <code>StashScene</code>: - Model name: <code>model CachedScene</code> -&gt; <code>model StashScene</code> - Relations in junction tables: <code>CachedScene</code> -&gt; <code>StashScene</code></p> <p><strong>Step 2: Rename CachedPerformer to StashPerformer</strong></p> <p>Find all occurrences of <code>CachedPerformer</code> and replace with <code>StashPerformer</code>.</p> <p><strong>Step 3: Rename CachedStudio to StashStudio</strong></p> <p>Find all occurrences of <code>CachedStudio</code> and replace with <code>StashStudio</code>.</p> <p><strong>Step 4: Rename CachedTag to StashTag</strong></p> <p>Find all occurrences of <code>CachedTag</code> and replace with <code>StashTag</code>.</p> <p><strong>Step 5: Rename CachedGroup to StashGroup</strong></p> <p>Find all occurrences of <code>CachedGroup</code> and replace with <code>StashGroup</code>.</p> <p><strong>Step 6: Rename CachedGallery to StashGallery</strong></p> <p>Find all occurrences of <code>CachedGallery</code> and replace with <code>StashGallery</code>.</p> <p><strong>Step 7: Rename CachedImage to StashImage</strong></p> <p>Find all occurrences of <code>CachedImage</code> and replace with <code>StashImage</code>.</p> <p><strong>Step 8: Validate schema syntax</strong></p> <p>Run: <code>cd server &amp;&amp; npx prisma validate</code> Expected: "The Prisma schema is valid."</p> <p><strong>Step 9: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>git<span class=w> </span>add<span class=w> </span>server/prisma/schema.prisma
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: rename Cached* tables to Stash* prefix&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-3-update-prisma-schema-add-tag-junction-tables>Task 3: Update Prisma Schema - Add Tag Junction Tables<a class=headerlink href=#task-3-update-prisma-schema-add-tag-junction-tables title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/prisma/schema.prisma</code></p> <p><strong>Step 1: Add PerformerTag junction table</strong></p> <p>Add after GalleryPerformer model:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>model PerformerTag {
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    performerId     String
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    tagId           String
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    performer       StashPerformer @relation(fields: [performerId], references: [id], onDelete: Cascade)
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>    tag             StashTag       @relation(fields: [tagId], references: [id], onDelete: Cascade)
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    @@id([performerId, tagId])
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>    @@index([tagId])
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>}
</span></code></pre></div> <p><strong>Step 2: Add StudioTag junction table</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>model StudioTag {
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    studioId        String
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    tagId           String
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    studio          StashStudio    @relation(fields: [studioId], references: [id], onDelete: Cascade)
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    tag             StashTag       @relation(fields: [tagId], references: [id], onDelete: Cascade)
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    @@id([studioId, tagId])
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    @@index([tagId])
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>}
</span></code></pre></div> <p><strong>Step 3: Add GalleryTag junction table</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>model GalleryTag {
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    galleryId       String
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    tagId           String
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    gallery         StashGallery   @relation(fields: [galleryId], references: [id], onDelete: Cascade)
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    tag             StashTag       @relation(fields: [tagId], references: [id], onDelete: Cascade)
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    @@id([galleryId, tagId])
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>    @@index([tagId])
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>}
</span></code></pre></div> <p><strong>Step 4: Add GroupTag junction table</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>model GroupTag {
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>    groupId         String
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>    tagId           String
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>    group           StashGroup     @relation(fields: [groupId], references: [id], onDelete: Cascade)
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>    tag             StashTag       @relation(fields: [tagId], references: [id], onDelete: Cascade)
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>    @@id([groupId, tagId])
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>    @@index([tagId])
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>}
</span></code></pre></div> <p><strong>Step 5: Add relations to StashPerformer</strong></p> <p>In <code>StashPerformer</code> model, add: <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>    tags            PerformerTag[]
</span></code></pre></div></p> <p><strong>Step 6: Add relations to StashStudio</strong></p> <p>In <code>StashStudio</code> model, add: <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>    tags            StudioTag[]
</span></code></pre></div></p> <p><strong>Step 7: Add relations to StashGallery</strong></p> <p>In <code>StashGallery</code> model, add: <div class="language-text highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>    tags            GalleryTag[]
</span></code></pre></div></p> <p><strong>Step 8: Add relations to StashGroup</strong></p> <p>In <code>StashGroup</code> model, add: <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>    tags            GroupTag[]
</span></code></pre></div></p> <p><strong>Step 9: Add relations to StashTag</strong></p> <p>In <code>StashTag</code> model, add: <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>    performers      PerformerTag[]
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>    studios         StudioTag[]
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    galleries       GalleryTag[]
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    groups          GroupTag[]
</span></code></pre></div></p> <p><strong>Step 10: Validate schema syntax</strong></p> <p>Run: <code>cd server &amp;&amp; npx prisma validate</code> Expected: "The Prisma schema is valid."</p> <p><strong>Step 11: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>git<span class=w> </span>add<span class=w> </span>server/prisma/schema.prisma
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat: add tag junction tables (PerformerTag, StudioTag, GalleryTag, GroupTag)&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-4-update-prisma-schema-remove-denormalized-count-fields>Task 4: Update Prisma Schema - Remove Denormalized Count Fields<a class=headerlink href=#task-4-update-prisma-schema-remove-denormalized-count-fields title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/prisma/schema.prisma</code></p> <p><strong>Step 1: Remove count fields from StashPerformer</strong></p> <p>Remove these lines from <code>StashPerformer</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>    sceneCount      Int       @default(0)
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>    imageCount      Int       @default(0)
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    galleryCount    Int       @default(0)
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>    groupCount      Int       @default(0)
</span></code></pre></div></p> <p>Also remove the index: <div class="language-text highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>    @@index([sceneCount])
</span></code></pre></div></p> <p><strong>Step 2: Remove count fields from StashStudio</strong></p> <p>Remove these lines from <code>StashStudio</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>    sceneCount      Int       @default(0)
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>    imageCount      Int       @default(0)
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>    galleryCount    Int       @default(0)
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    performerCount  Int       @default(0)
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>    groupCount      Int       @default(0)
</span></code></pre></div></p> <p>Also remove the index: <div class="language-text highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>    @@index([sceneCount])
</span></code></pre></div></p> <p><strong>Step 3: Remove count fields from StashTag</strong></p> <p>Remove these lines from <code>StashTag</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>    sceneCount      Int       @default(0)
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>    imageCount      Int       @default(0)
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    galleryCount    Int       @default(0)
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    performerCount  Int       @default(0)
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>    studioCount     Int       @default(0)
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>    groupCount      Int       @default(0)
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>    sceneMarkerCount Int      @default(0)
</span></code></pre></div></p> <p>Also remove the index: <div class="language-text highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>    @@index([sceneCount])
</span></code></pre></div></p> <p><strong>Step 4: Remove count fields from StashGroup</strong></p> <p>Remove these lines from <code>StashGroup</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>    sceneCount      Int       @default(0)
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>    performerCount  Int       @default(0)
</span></code></pre></div></p> <p>Also remove the index: <div class="language-text highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>    @@index([sceneCount])
</span></code></pre></div></p> <p><strong>Step 5: Remove count field from StashGallery</strong></p> <p>Remove this line from <code>StashGallery</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>    imageCount      Int       @default(0)
</span></code></pre></div></p> <p>Also remove the index: <div class="language-text highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>    @@index([imageCount])
</span></code></pre></div></p> <p><strong>Step 6: Validate schema syntax</strong></p> <p>Run: <code>cd server &amp;&amp; npx prisma validate</code> Expected: "The Prisma schema is valid."</p> <p><strong>Step 7: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>git<span class=w> </span>add<span class=w> </span>server/prisma/schema.prisma
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: remove denormalized count fields (will compute via JOINs)&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-5-update-prisma-schema-remove-tagids-json-fields>Task 5: Update Prisma Schema - Remove tagIds JSON Fields<a class=headerlink href=#task-5-update-prisma-schema-remove-tagids-json-fields title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/prisma/schema.prisma</code></p> <p><strong>Step 1: Remove tagIds from StashPerformer</strong></p> <p>Remove this line from <code>StashPerformer</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>    tagIds          String?                          // JSON array of tag IDs
</span></code></pre></div></p> <p><strong>Step 2: Remove tagIds from StashStudio</strong></p> <p>Remove this line from <code>StashStudio</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>    tagIds          String?                          // JSON array of tag IDs
</span></code></pre></div></p> <p><strong>Step 3: Remove tagIds from StashGroup</strong></p> <p>Remove this line from <code>StashGroup</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>    tagIds          String?                          // JSON array of tag IDs
</span></code></pre></div></p> <p><strong>Step 4: Remove tagIds from StashGallery</strong></p> <p>Remove this line from <code>StashGallery</code>: <div class="language-text highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>    tagIds          String?                          // JSON array of tag IDs
</span></code></pre></div></p> <p><strong>Step 5: Validate schema syntax</strong></p> <p>Run: <code>cd server &amp;&amp; npx prisma validate</code> Expected: "The Prisma schema is valid."</p> <p><strong>Step 6: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>git<span class=w> </span>add<span class=w> </span>server/prisma/schema.prisma
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: remove tagIds JSON columns (replaced by junction tables)&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-6-update-prisma-schema-remove-deprecated-data-field>Task 6: Update Prisma Schema - Remove Deprecated data Field<a class=headerlink href=#task-6-update-prisma-schema-remove-deprecated-data-field title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/prisma/schema.prisma</code></p> <p><strong>Step 1: Remove data field from all Stash* models</strong></p> <p>Remove from StashScene, StashPerformer, StashStudio, StashTag, StashGroup, StashGallery, StashImage: <div class="language-text highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>    data            String    @default(&quot;{}&quot;)         // DEPRECATED: JSON blob
</span></code></pre></div></p> <p><strong>Step 2: Validate schema syntax</strong></p> <p>Run: <code>cd server &amp;&amp; npx prisma validate</code> Expected: "The Prisma schema is valid."</p> <p><strong>Step 3: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>git<span class=w> </span>add<span class=w> </span>server/prisma/schema.prisma
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: remove deprecated data JSON blob field&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-7-create-squashed-migration-file>Task 7: Create Squashed Migration File<a class=headerlink href=#task-7-create-squashed-migration-file title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Create: <code>server/prisma/migrations/20251211000000_stash_entities/migration.sql</code></p> <p><strong>Step 1: Create migration directory</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>mkdir<span class=w> </span>-p<span class=w> </span>server/prisma/migrations/20251211000000_stash_entities
</span></code></pre></div> <p><strong>Step 2: Write the complete migration SQL</strong></p> <p>Create <code>server/prisma/migrations/20251211000000_stash_entities/migration.sql</code> with all table definitions:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1>-- CreateTable: StashScene</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=ss>&quot;stashInstanceId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=w>    </span><span class=ss>&quot;title&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=w>    </span><span class=ss>&quot;code&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>    </span><span class=ss>&quot;date&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>    </span><span class=ss>&quot;studioId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=w>    </span><span class=ss>&quot;rating100&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=w>    </span><span class=ss>&quot;duration&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=w>    </span><span class=ss>&quot;organized&quot;</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>false</span><span class=p>,</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=w>    </span><span class=ss>&quot;details&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=w>    </span><span class=ss>&quot;filePath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a><span class=w>    </span><span class=ss>&quot;fileBitRate&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=w>    </span><span class=ss>&quot;fileFrameRate&quot;</span><span class=w> </span><span class=nb>REAL</span><span class=p>,</span>
</span><span id=__span-32-16><a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=w>    </span><span class=ss>&quot;fileWidth&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-17><a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a><span class=w>    </span><span class=ss>&quot;fileHeight&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-18><a id=__codelineno-32-18 name=__codelineno-32-18 href=#__codelineno-32-18></a><span class=w>    </span><span class=ss>&quot;fileVideoCodec&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-19><a id=__codelineno-32-19 name=__codelineno-32-19 href=#__codelineno-32-19></a><span class=w>    </span><span class=ss>&quot;fileAudioCodec&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-20><a id=__codelineno-32-20 name=__codelineno-32-20 href=#__codelineno-32-20></a><span class=w>    </span><span class=ss>&quot;fileSize&quot;</span><span class=w> </span><span class=nb>BIGINT</span><span class=p>,</span>
</span><span id=__span-32-21><a id=__codelineno-32-21 name=__codelineno-32-21 href=#__codelineno-32-21></a><span class=w>    </span><span class=ss>&quot;pathScreenshot&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-22><a id=__codelineno-32-22 name=__codelineno-32-22 href=#__codelineno-32-22></a><span class=w>    </span><span class=ss>&quot;pathPreview&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-23><a id=__codelineno-32-23 name=__codelineno-32-23 href=#__codelineno-32-23></a><span class=w>    </span><span class=ss>&quot;pathSprite&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-24><a id=__codelineno-32-24 name=__codelineno-32-24 href=#__codelineno-32-24></a><span class=w>    </span><span class=ss>&quot;pathVtt&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-25><a id=__codelineno-32-25 name=__codelineno-32-25 href=#__codelineno-32-25></a><span class=w>    </span><span class=ss>&quot;pathChaptersVtt&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-26><a id=__codelineno-32-26 name=__codelineno-32-26 href=#__codelineno-32-26></a><span class=w>    </span><span class=ss>&quot;pathStream&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-27><a id=__codelineno-32-27 name=__codelineno-32-27 href=#__codelineno-32-27></a><span class=w>    </span><span class=ss>&quot;pathCaption&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-28><a id=__codelineno-32-28 name=__codelineno-32-28 href=#__codelineno-32-28></a><span class=w>    </span><span class=ss>&quot;streams&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-29><a id=__codelineno-32-29 name=__codelineno-32-29 href=#__codelineno-32-29></a><span class=w>    </span><span class=ss>&quot;oCounter&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-32-30><a id=__codelineno-32-30 name=__codelineno-32-30 href=#__codelineno-32-30></a><span class=w>    </span><span class=ss>&quot;playCount&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-32-31><a id=__codelineno-32-31 name=__codelineno-32-31 href=#__codelineno-32-31></a><span class=w>    </span><span class=ss>&quot;playDuration&quot;</span><span class=w> </span><span class=nb>REAL</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-32-32><a id=__codelineno-32-32 name=__codelineno-32-32 href=#__codelineno-32-32></a><span class=w>    </span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-33><a id=__codelineno-32-33 name=__codelineno-32-33 href=#__codelineno-32-33></a><span class=w>    </span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-34><a id=__codelineno-32-34 name=__codelineno-32-34 href=#__codelineno-32-34></a><span class=w>    </span><span class=ss>&quot;syncedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-32-35><a id=__codelineno-32-35 name=__codelineno-32-35 href=#__codelineno-32-35></a><span class=w>    </span><span class=ss>&quot;deletedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span>
</span><span id=__span-32-36><a id=__codelineno-32-36 name=__codelineno-32-36 href=#__codelineno-32-36></a><span class=p>);</span>
</span><span id=__span-32-37><a id=__codelineno-32-37 name=__codelineno-32-37 href=#__codelineno-32-37></a>
</span><span id=__span-32-38><a id=__codelineno-32-38 name=__codelineno-32-38 href=#__codelineno-32-38></a><span class=c1>-- CreateTable: StashPerformer</span>
</span><span id=__span-32-39><a id=__codelineno-32-39 name=__codelineno-32-39 href=#__codelineno-32-39></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-40><a id=__codelineno-32-40 name=__codelineno-32-40 href=#__codelineno-32-40></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-32-41><a id=__codelineno-32-41 name=__codelineno-32-41 href=#__codelineno-32-41></a><span class=w>    </span><span class=ss>&quot;stashInstanceId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-42><a id=__codelineno-32-42 name=__codelineno-32-42 href=#__codelineno-32-42></a><span class=w>    </span><span class=ss>&quot;name&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-43><a id=__codelineno-32-43 name=__codelineno-32-43 href=#__codelineno-32-43></a><span class=w>    </span><span class=ss>&quot;disambiguation&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-44><a id=__codelineno-32-44 name=__codelineno-32-44 href=#__codelineno-32-44></a><span class=w>    </span><span class=ss>&quot;gender&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-45><a id=__codelineno-32-45 name=__codelineno-32-45 href=#__codelineno-32-45></a><span class=w>    </span><span class=ss>&quot;birthdate&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-46><a id=__codelineno-32-46 name=__codelineno-32-46 href=#__codelineno-32-46></a><span class=w>    </span><span class=ss>&quot;favorite&quot;</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>false</span><span class=p>,</span>
</span><span id=__span-32-47><a id=__codelineno-32-47 name=__codelineno-32-47 href=#__codelineno-32-47></a><span class=w>    </span><span class=ss>&quot;rating100&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-48><a id=__codelineno-32-48 name=__codelineno-32-48 href=#__codelineno-32-48></a><span class=w>    </span><span class=ss>&quot;details&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-49><a id=__codelineno-32-49 name=__codelineno-32-49 href=#__codelineno-32-49></a><span class=w>    </span><span class=ss>&quot;aliasList&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-50><a id=__codelineno-32-50 name=__codelineno-32-50 href=#__codelineno-32-50></a><span class=w>    </span><span class=ss>&quot;country&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-51><a id=__codelineno-32-51 name=__codelineno-32-51 href=#__codelineno-32-51></a><span class=w>    </span><span class=ss>&quot;ethnicity&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-52><a id=__codelineno-32-52 name=__codelineno-32-52 href=#__codelineno-32-52></a><span class=w>    </span><span class=ss>&quot;hairColor&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-53><a id=__codelineno-32-53 name=__codelineno-32-53 href=#__codelineno-32-53></a><span class=w>    </span><span class=ss>&quot;eyeColor&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-54><a id=__codelineno-32-54 name=__codelineno-32-54 href=#__codelineno-32-54></a><span class=w>    </span><span class=ss>&quot;heightCm&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-55><a id=__codelineno-32-55 name=__codelineno-32-55 href=#__codelineno-32-55></a><span class=w>    </span><span class=ss>&quot;weightKg&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-56><a id=__codelineno-32-56 name=__codelineno-32-56 href=#__codelineno-32-56></a><span class=w>    </span><span class=ss>&quot;measurements&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-57><a id=__codelineno-32-57 name=__codelineno-32-57 href=#__codelineno-32-57></a><span class=w>    </span><span class=ss>&quot;tattoos&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-58><a id=__codelineno-32-58 name=__codelineno-32-58 href=#__codelineno-32-58></a><span class=w>    </span><span class=ss>&quot;piercings&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-59><a id=__codelineno-32-59 name=__codelineno-32-59 href=#__codelineno-32-59></a><span class=w>    </span><span class=ss>&quot;careerLength&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-60><a id=__codelineno-32-60 name=__codelineno-32-60 href=#__codelineno-32-60></a><span class=w>    </span><span class=ss>&quot;deathDate&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-61><a id=__codelineno-32-61 name=__codelineno-32-61 href=#__codelineno-32-61></a><span class=w>    </span><span class=ss>&quot;url&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-62><a id=__codelineno-32-62 name=__codelineno-32-62 href=#__codelineno-32-62></a><span class=w>    </span><span class=ss>&quot;imagePath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-63><a id=__codelineno-32-63 name=__codelineno-32-63 href=#__codelineno-32-63></a><span class=w>    </span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-64><a id=__codelineno-32-64 name=__codelineno-32-64 href=#__codelineno-32-64></a><span class=w>    </span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-65><a id=__codelineno-32-65 name=__codelineno-32-65 href=#__codelineno-32-65></a><span class=w>    </span><span class=ss>&quot;syncedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-32-66><a id=__codelineno-32-66 name=__codelineno-32-66 href=#__codelineno-32-66></a><span class=w>    </span><span class=ss>&quot;deletedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span>
</span><span id=__span-32-67><a id=__codelineno-32-67 name=__codelineno-32-67 href=#__codelineno-32-67></a><span class=p>);</span>
</span><span id=__span-32-68><a id=__codelineno-32-68 name=__codelineno-32-68 href=#__codelineno-32-68></a>
</span><span id=__span-32-69><a id=__codelineno-32-69 name=__codelineno-32-69 href=#__codelineno-32-69></a><span class=c1>-- CreateTable: StashStudio</span>
</span><span id=__span-32-70><a id=__codelineno-32-70 name=__codelineno-32-70 href=#__codelineno-32-70></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;StashStudio&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-71><a id=__codelineno-32-71 name=__codelineno-32-71 href=#__codelineno-32-71></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-32-72><a id=__codelineno-32-72 name=__codelineno-32-72 href=#__codelineno-32-72></a><span class=w>    </span><span class=ss>&quot;stashInstanceId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-73><a id=__codelineno-32-73 name=__codelineno-32-73 href=#__codelineno-32-73></a><span class=w>    </span><span class=ss>&quot;name&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-74><a id=__codelineno-32-74 name=__codelineno-32-74 href=#__codelineno-32-74></a><span class=w>    </span><span class=ss>&quot;parentId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-75><a id=__codelineno-32-75 name=__codelineno-32-75 href=#__codelineno-32-75></a><span class=w>    </span><span class=ss>&quot;favorite&quot;</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>false</span><span class=p>,</span>
</span><span id=__span-32-76><a id=__codelineno-32-76 name=__codelineno-32-76 href=#__codelineno-32-76></a><span class=w>    </span><span class=ss>&quot;rating100&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-77><a id=__codelineno-32-77 name=__codelineno-32-77 href=#__codelineno-32-77></a><span class=w>    </span><span class=ss>&quot;details&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-78><a id=__codelineno-32-78 name=__codelineno-32-78 href=#__codelineno-32-78></a><span class=w>    </span><span class=ss>&quot;url&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-79><a id=__codelineno-32-79 name=__codelineno-32-79 href=#__codelineno-32-79></a><span class=w>    </span><span class=ss>&quot;imagePath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-80><a id=__codelineno-32-80 name=__codelineno-32-80 href=#__codelineno-32-80></a><span class=w>    </span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-81><a id=__codelineno-32-81 name=__codelineno-32-81 href=#__codelineno-32-81></a><span class=w>    </span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-82><a id=__codelineno-32-82 name=__codelineno-32-82 href=#__codelineno-32-82></a><span class=w>    </span><span class=ss>&quot;syncedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-32-83><a id=__codelineno-32-83 name=__codelineno-32-83 href=#__codelineno-32-83></a><span class=w>    </span><span class=ss>&quot;deletedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span>
</span><span id=__span-32-84><a id=__codelineno-32-84 name=__codelineno-32-84 href=#__codelineno-32-84></a><span class=p>);</span>
</span><span id=__span-32-85><a id=__codelineno-32-85 name=__codelineno-32-85 href=#__codelineno-32-85></a>
</span><span id=__span-32-86><a id=__codelineno-32-86 name=__codelineno-32-86 href=#__codelineno-32-86></a><span class=c1>-- CreateTable: StashTag</span>
</span><span id=__span-32-87><a id=__codelineno-32-87 name=__codelineno-32-87 href=#__codelineno-32-87></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-88><a id=__codelineno-32-88 name=__codelineno-32-88 href=#__codelineno-32-88></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-32-89><a id=__codelineno-32-89 name=__codelineno-32-89 href=#__codelineno-32-89></a><span class=w>    </span><span class=ss>&quot;stashInstanceId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-90><a id=__codelineno-32-90 name=__codelineno-32-90 href=#__codelineno-32-90></a><span class=w>    </span><span class=ss>&quot;name&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-91><a id=__codelineno-32-91 name=__codelineno-32-91 href=#__codelineno-32-91></a><span class=w>    </span><span class=ss>&quot;favorite&quot;</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>false</span><span class=p>,</span>
</span><span id=__span-32-92><a id=__codelineno-32-92 name=__codelineno-32-92 href=#__codelineno-32-92></a><span class=w>    </span><span class=ss>&quot;description&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-93><a id=__codelineno-32-93 name=__codelineno-32-93 href=#__codelineno-32-93></a><span class=w>    </span><span class=ss>&quot;aliases&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-94><a id=__codelineno-32-94 name=__codelineno-32-94 href=#__codelineno-32-94></a><span class=w>    </span><span class=ss>&quot;parentIds&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-95><a id=__codelineno-32-95 name=__codelineno-32-95 href=#__codelineno-32-95></a><span class=w>    </span><span class=ss>&quot;imagePath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-96><a id=__codelineno-32-96 name=__codelineno-32-96 href=#__codelineno-32-96></a><span class=w>    </span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-97><a id=__codelineno-32-97 name=__codelineno-32-97 href=#__codelineno-32-97></a><span class=w>    </span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-98><a id=__codelineno-32-98 name=__codelineno-32-98 href=#__codelineno-32-98></a><span class=w>    </span><span class=ss>&quot;syncedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-32-99><a id=__codelineno-32-99 name=__codelineno-32-99 href=#__codelineno-32-99></a><span class=w>    </span><span class=ss>&quot;deletedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span>
</span><span id=__span-32-100><a id=__codelineno-32-100 name=__codelineno-32-100 href=#__codelineno-32-100></a><span class=p>);</span>
</span><span id=__span-32-101><a id=__codelineno-32-101 name=__codelineno-32-101 href=#__codelineno-32-101></a>
</span><span id=__span-32-102><a id=__codelineno-32-102 name=__codelineno-32-102 href=#__codelineno-32-102></a><span class=c1>-- CreateTable: StashGroup</span>
</span><span id=__span-32-103><a id=__codelineno-32-103 name=__codelineno-32-103 href=#__codelineno-32-103></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-104><a id=__codelineno-32-104 name=__codelineno-32-104 href=#__codelineno-32-104></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-32-105><a id=__codelineno-32-105 name=__codelineno-32-105 href=#__codelineno-32-105></a><span class=w>    </span><span class=ss>&quot;stashInstanceId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-106><a id=__codelineno-32-106 name=__codelineno-32-106 href=#__codelineno-32-106></a><span class=w>    </span><span class=ss>&quot;name&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-107><a id=__codelineno-32-107 name=__codelineno-32-107 href=#__codelineno-32-107></a><span class=w>    </span><span class=ss>&quot;date&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-108><a id=__codelineno-32-108 name=__codelineno-32-108 href=#__codelineno-32-108></a><span class=w>    </span><span class=ss>&quot;studioId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-109><a id=__codelineno-32-109 name=__codelineno-32-109 href=#__codelineno-32-109></a><span class=w>    </span><span class=ss>&quot;rating100&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-110><a id=__codelineno-32-110 name=__codelineno-32-110 href=#__codelineno-32-110></a><span class=w>    </span><span class=ss>&quot;duration&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-111><a id=__codelineno-32-111 name=__codelineno-32-111 href=#__codelineno-32-111></a><span class=w>    </span><span class=ss>&quot;director&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-112><a id=__codelineno-32-112 name=__codelineno-32-112 href=#__codelineno-32-112></a><span class=w>    </span><span class=ss>&quot;synopsis&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-113><a id=__codelineno-32-113 name=__codelineno-32-113 href=#__codelineno-32-113></a><span class=w>    </span><span class=ss>&quot;urls&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-114><a id=__codelineno-32-114 name=__codelineno-32-114 href=#__codelineno-32-114></a><span class=w>    </span><span class=ss>&quot;frontImagePath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-115><a id=__codelineno-32-115 name=__codelineno-32-115 href=#__codelineno-32-115></a><span class=w>    </span><span class=ss>&quot;backImagePath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-116><a id=__codelineno-32-116 name=__codelineno-32-116 href=#__codelineno-32-116></a><span class=w>    </span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-117><a id=__codelineno-32-117 name=__codelineno-32-117 href=#__codelineno-32-117></a><span class=w>    </span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-118><a id=__codelineno-32-118 name=__codelineno-32-118 href=#__codelineno-32-118></a><span class=w>    </span><span class=ss>&quot;syncedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-32-119><a id=__codelineno-32-119 name=__codelineno-32-119 href=#__codelineno-32-119></a><span class=w>    </span><span class=ss>&quot;deletedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span>
</span><span id=__span-32-120><a id=__codelineno-32-120 name=__codelineno-32-120 href=#__codelineno-32-120></a><span class=p>);</span>
</span><span id=__span-32-121><a id=__codelineno-32-121 name=__codelineno-32-121 href=#__codelineno-32-121></a>
</span><span id=__span-32-122><a id=__codelineno-32-122 name=__codelineno-32-122 href=#__codelineno-32-122></a><span class=c1>-- CreateTable: StashGallery</span>
</span><span id=__span-32-123><a id=__codelineno-32-123 name=__codelineno-32-123 href=#__codelineno-32-123></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-124><a id=__codelineno-32-124 name=__codelineno-32-124 href=#__codelineno-32-124></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-32-125><a id=__codelineno-32-125 name=__codelineno-32-125 href=#__codelineno-32-125></a><span class=w>    </span><span class=ss>&quot;stashInstanceId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-126><a id=__codelineno-32-126 name=__codelineno-32-126 href=#__codelineno-32-126></a><span class=w>    </span><span class=ss>&quot;title&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-127><a id=__codelineno-32-127 name=__codelineno-32-127 href=#__codelineno-32-127></a><span class=w>    </span><span class=ss>&quot;date&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-128><a id=__codelineno-32-128 name=__codelineno-32-128 href=#__codelineno-32-128></a><span class=w>    </span><span class=ss>&quot;studioId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-129><a id=__codelineno-32-129 name=__codelineno-32-129 href=#__codelineno-32-129></a><span class=w>    </span><span class=ss>&quot;rating100&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-130><a id=__codelineno-32-130 name=__codelineno-32-130 href=#__codelineno-32-130></a><span class=w>    </span><span class=ss>&quot;details&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-131><a id=__codelineno-32-131 name=__codelineno-32-131 href=#__codelineno-32-131></a><span class=w>    </span><span class=ss>&quot;url&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-132><a id=__codelineno-32-132 name=__codelineno-32-132 href=#__codelineno-32-132></a><span class=w>    </span><span class=ss>&quot;code&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-133><a id=__codelineno-32-133 name=__codelineno-32-133 href=#__codelineno-32-133></a><span class=w>    </span><span class=ss>&quot;folderPath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-134><a id=__codelineno-32-134 name=__codelineno-32-134 href=#__codelineno-32-134></a><span class=w>    </span><span class=ss>&quot;coverPath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-135><a id=__codelineno-32-135 name=__codelineno-32-135 href=#__codelineno-32-135></a><span class=w>    </span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-136><a id=__codelineno-32-136 name=__codelineno-32-136 href=#__codelineno-32-136></a><span class=w>    </span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-137><a id=__codelineno-32-137 name=__codelineno-32-137 href=#__codelineno-32-137></a><span class=w>    </span><span class=ss>&quot;syncedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-32-138><a id=__codelineno-32-138 name=__codelineno-32-138 href=#__codelineno-32-138></a><span class=w>    </span><span class=ss>&quot;deletedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span>
</span><span id=__span-32-139><a id=__codelineno-32-139 name=__codelineno-32-139 href=#__codelineno-32-139></a><span class=p>);</span>
</span><span id=__span-32-140><a id=__codelineno-32-140 name=__codelineno-32-140 href=#__codelineno-32-140></a>
</span><span id=__span-32-141><a id=__codelineno-32-141 name=__codelineno-32-141 href=#__codelineno-32-141></a><span class=c1>-- CreateTable: StashImage</span>
</span><span id=__span-32-142><a id=__codelineno-32-142 name=__codelineno-32-142 href=#__codelineno-32-142></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-143><a id=__codelineno-32-143 name=__codelineno-32-143 href=#__codelineno-32-143></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-32-144><a id=__codelineno-32-144 name=__codelineno-32-144 href=#__codelineno-32-144></a><span class=w>    </span><span class=ss>&quot;stashInstanceId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-145><a id=__codelineno-32-145 name=__codelineno-32-145 href=#__codelineno-32-145></a><span class=w>    </span><span class=ss>&quot;title&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-146><a id=__codelineno-32-146 name=__codelineno-32-146 href=#__codelineno-32-146></a><span class=w>    </span><span class=ss>&quot;date&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-147><a id=__codelineno-32-147 name=__codelineno-32-147 href=#__codelineno-32-147></a><span class=w>    </span><span class=ss>&quot;studioId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-148><a id=__codelineno-32-148 name=__codelineno-32-148 href=#__codelineno-32-148></a><span class=w>    </span><span class=ss>&quot;rating100&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-149><a id=__codelineno-32-149 name=__codelineno-32-149 href=#__codelineno-32-149></a><span class=w>    </span><span class=ss>&quot;oCounter&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-32-150><a id=__codelineno-32-150 name=__codelineno-32-150 href=#__codelineno-32-150></a><span class=w>    </span><span class=ss>&quot;organized&quot;</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>false</span><span class=p>,</span>
</span><span id=__span-32-151><a id=__codelineno-32-151 name=__codelineno-32-151 href=#__codelineno-32-151></a><span class=w>    </span><span class=ss>&quot;filePath&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-152><a id=__codelineno-32-152 name=__codelineno-32-152 href=#__codelineno-32-152></a><span class=w>    </span><span class=ss>&quot;width&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-153><a id=__codelineno-32-153 name=__codelineno-32-153 href=#__codelineno-32-153></a><span class=w>    </span><span class=ss>&quot;height&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-154><a id=__codelineno-32-154 name=__codelineno-32-154 href=#__codelineno-32-154></a><span class=w>    </span><span class=ss>&quot;fileSize&quot;</span><span class=w> </span><span class=nb>BIGINT</span><span class=p>,</span>
</span><span id=__span-32-155><a id=__codelineno-32-155 name=__codelineno-32-155 href=#__codelineno-32-155></a><span class=w>    </span><span class=ss>&quot;pathThumbnail&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-156><a id=__codelineno-32-156 name=__codelineno-32-156 href=#__codelineno-32-156></a><span class=w>    </span><span class=ss>&quot;pathPreview&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-157><a id=__codelineno-32-157 name=__codelineno-32-157 href=#__codelineno-32-157></a><span class=w>    </span><span class=ss>&quot;pathImage&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-158><a id=__codelineno-32-158 name=__codelineno-32-158 href=#__codelineno-32-158></a><span class=w>    </span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-159><a id=__codelineno-32-159 name=__codelineno-32-159 href=#__codelineno-32-159></a><span class=w>    </span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-160><a id=__codelineno-32-160 name=__codelineno-32-160 href=#__codelineno-32-160></a><span class=w>    </span><span class=ss>&quot;syncedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-32-161><a id=__codelineno-32-161 name=__codelineno-32-161 href=#__codelineno-32-161></a><span class=w>    </span><span class=ss>&quot;deletedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span>
</span><span id=__span-32-162><a id=__codelineno-32-162 name=__codelineno-32-162 href=#__codelineno-32-162></a><span class=p>);</span>
</span><span id=__span-32-163><a id=__codelineno-32-163 name=__codelineno-32-163 href=#__codelineno-32-163></a>
</span><span id=__span-32-164><a id=__codelineno-32-164 name=__codelineno-32-164 href=#__codelineno-32-164></a><span class=c1>-- CreateTable: ScenePerformer</span>
</span><span id=__span-32-165><a id=__codelineno-32-165 name=__codelineno-32-165 href=#__codelineno-32-165></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;ScenePerformer&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-166><a id=__codelineno-32-166 name=__codelineno-32-166 href=#__codelineno-32-166></a><span class=w>    </span><span class=ss>&quot;sceneId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-167><a id=__codelineno-32-167 name=__codelineno-32-167 href=#__codelineno-32-167></a><span class=w>    </span><span class=ss>&quot;performerId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-168><a id=__codelineno-32-168 name=__codelineno-32-168 href=#__codelineno-32-168></a>
</span><span id=__span-32-169><a id=__codelineno-32-169 name=__codelineno-32-169 href=#__codelineno-32-169></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;sceneId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;performerId&quot;</span><span class=p>),</span>
</span><span id=__span-32-170><a id=__codelineno-32-170 name=__codelineno-32-170 href=#__codelineno-32-170></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;ScenePerformer_sceneId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;sceneId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-171><a id=__codelineno-32-171 name=__codelineno-32-171 href=#__codelineno-32-171></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;ScenePerformer_performerId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;performerId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-172><a id=__codelineno-32-172 name=__codelineno-32-172 href=#__codelineno-32-172></a><span class=p>);</span>
</span><span id=__span-32-173><a id=__codelineno-32-173 name=__codelineno-32-173 href=#__codelineno-32-173></a>
</span><span id=__span-32-174><a id=__codelineno-32-174 name=__codelineno-32-174 href=#__codelineno-32-174></a><span class=c1>-- CreateTable: SceneTag</span>
</span><span id=__span-32-175><a id=__codelineno-32-175 name=__codelineno-32-175 href=#__codelineno-32-175></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;SceneTag&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-176><a id=__codelineno-32-176 name=__codelineno-32-176 href=#__codelineno-32-176></a><span class=w>    </span><span class=ss>&quot;sceneId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-177><a id=__codelineno-32-177 name=__codelineno-32-177 href=#__codelineno-32-177></a><span class=w>    </span><span class=ss>&quot;tagId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-178><a id=__codelineno-32-178 name=__codelineno-32-178 href=#__codelineno-32-178></a>
</span><span id=__span-32-179><a id=__codelineno-32-179 name=__codelineno-32-179 href=#__codelineno-32-179></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;sceneId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;tagId&quot;</span><span class=p>),</span>
</span><span id=__span-32-180><a id=__codelineno-32-180 name=__codelineno-32-180 href=#__codelineno-32-180></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;SceneTag_sceneId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;sceneId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-181><a id=__codelineno-32-181 name=__codelineno-32-181 href=#__codelineno-32-181></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;SceneTag_tagId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-182><a id=__codelineno-32-182 name=__codelineno-32-182 href=#__codelineno-32-182></a><span class=p>);</span>
</span><span id=__span-32-183><a id=__codelineno-32-183 name=__codelineno-32-183 href=#__codelineno-32-183></a>
</span><span id=__span-32-184><a id=__codelineno-32-184 name=__codelineno-32-184 href=#__codelineno-32-184></a><span class=c1>-- CreateTable: SceneGroup</span>
</span><span id=__span-32-185><a id=__codelineno-32-185 name=__codelineno-32-185 href=#__codelineno-32-185></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;SceneGroup&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-186><a id=__codelineno-32-186 name=__codelineno-32-186 href=#__codelineno-32-186></a><span class=w>    </span><span class=ss>&quot;sceneId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-187><a id=__codelineno-32-187 name=__codelineno-32-187 href=#__codelineno-32-187></a><span class=w>    </span><span class=ss>&quot;groupId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-188><a id=__codelineno-32-188 name=__codelineno-32-188 href=#__codelineno-32-188></a><span class=w>    </span><span class=ss>&quot;sceneIndex&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-189><a id=__codelineno-32-189 name=__codelineno-32-189 href=#__codelineno-32-189></a>
</span><span id=__span-32-190><a id=__codelineno-32-190 name=__codelineno-32-190 href=#__codelineno-32-190></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;sceneId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;groupId&quot;</span><span class=p>),</span>
</span><span id=__span-32-191><a id=__codelineno-32-191 name=__codelineno-32-191 href=#__codelineno-32-191></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;SceneGroup_sceneId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;sceneId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-192><a id=__codelineno-32-192 name=__codelineno-32-192 href=#__codelineno-32-192></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;SceneGroup_groupId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;groupId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-193><a id=__codelineno-32-193 name=__codelineno-32-193 href=#__codelineno-32-193></a><span class=p>);</span>
</span><span id=__span-32-194><a id=__codelineno-32-194 name=__codelineno-32-194 href=#__codelineno-32-194></a>
</span><span id=__span-32-195><a id=__codelineno-32-195 name=__codelineno-32-195 href=#__codelineno-32-195></a><span class=c1>-- CreateTable: SceneGallery</span>
</span><span id=__span-32-196><a id=__codelineno-32-196 name=__codelineno-32-196 href=#__codelineno-32-196></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;SceneGallery&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-197><a id=__codelineno-32-197 name=__codelineno-32-197 href=#__codelineno-32-197></a><span class=w>    </span><span class=ss>&quot;sceneId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-198><a id=__codelineno-32-198 name=__codelineno-32-198 href=#__codelineno-32-198></a><span class=w>    </span><span class=ss>&quot;galleryId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-199><a id=__codelineno-32-199 name=__codelineno-32-199 href=#__codelineno-32-199></a>
</span><span id=__span-32-200><a id=__codelineno-32-200 name=__codelineno-32-200 href=#__codelineno-32-200></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;sceneId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;galleryId&quot;</span><span class=p>),</span>
</span><span id=__span-32-201><a id=__codelineno-32-201 name=__codelineno-32-201 href=#__codelineno-32-201></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;SceneGallery_sceneId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;sceneId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-202><a id=__codelineno-32-202 name=__codelineno-32-202 href=#__codelineno-32-202></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;SceneGallery_galleryId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;galleryId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-203><a id=__codelineno-32-203 name=__codelineno-32-203 href=#__codelineno-32-203></a><span class=p>);</span>
</span><span id=__span-32-204><a id=__codelineno-32-204 name=__codelineno-32-204 href=#__codelineno-32-204></a>
</span><span id=__span-32-205><a id=__codelineno-32-205 name=__codelineno-32-205 href=#__codelineno-32-205></a><span class=c1>-- CreateTable: ImagePerformer</span>
</span><span id=__span-32-206><a id=__codelineno-32-206 name=__codelineno-32-206 href=#__codelineno-32-206></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;ImagePerformer&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-207><a id=__codelineno-32-207 name=__codelineno-32-207 href=#__codelineno-32-207></a><span class=w>    </span><span class=ss>&quot;imageId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-208><a id=__codelineno-32-208 name=__codelineno-32-208 href=#__codelineno-32-208></a><span class=w>    </span><span class=ss>&quot;performerId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-209><a id=__codelineno-32-209 name=__codelineno-32-209 href=#__codelineno-32-209></a>
</span><span id=__span-32-210><a id=__codelineno-32-210 name=__codelineno-32-210 href=#__codelineno-32-210></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;imageId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;performerId&quot;</span><span class=p>),</span>
</span><span id=__span-32-211><a id=__codelineno-32-211 name=__codelineno-32-211 href=#__codelineno-32-211></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;ImagePerformer_imageId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;imageId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-212><a id=__codelineno-32-212 name=__codelineno-32-212 href=#__codelineno-32-212></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;ImagePerformer_performerId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;performerId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-213><a id=__codelineno-32-213 name=__codelineno-32-213 href=#__codelineno-32-213></a><span class=p>);</span>
</span><span id=__span-32-214><a id=__codelineno-32-214 name=__codelineno-32-214 href=#__codelineno-32-214></a>
</span><span id=__span-32-215><a id=__codelineno-32-215 name=__codelineno-32-215 href=#__codelineno-32-215></a><span class=c1>-- CreateTable: ImageTag</span>
</span><span id=__span-32-216><a id=__codelineno-32-216 name=__codelineno-32-216 href=#__codelineno-32-216></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;ImageTag&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-217><a id=__codelineno-32-217 name=__codelineno-32-217 href=#__codelineno-32-217></a><span class=w>    </span><span class=ss>&quot;imageId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-218><a id=__codelineno-32-218 name=__codelineno-32-218 href=#__codelineno-32-218></a><span class=w>    </span><span class=ss>&quot;tagId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-219><a id=__codelineno-32-219 name=__codelineno-32-219 href=#__codelineno-32-219></a>
</span><span id=__span-32-220><a id=__codelineno-32-220 name=__codelineno-32-220 href=#__codelineno-32-220></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;imageId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;tagId&quot;</span><span class=p>),</span>
</span><span id=__span-32-221><a id=__codelineno-32-221 name=__codelineno-32-221 href=#__codelineno-32-221></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;ImageTag_imageId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;imageId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-222><a id=__codelineno-32-222 name=__codelineno-32-222 href=#__codelineno-32-222></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;ImageTag_tagId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-223><a id=__codelineno-32-223 name=__codelineno-32-223 href=#__codelineno-32-223></a><span class=p>);</span>
</span><span id=__span-32-224><a id=__codelineno-32-224 name=__codelineno-32-224 href=#__codelineno-32-224></a>
</span><span id=__span-32-225><a id=__codelineno-32-225 name=__codelineno-32-225 href=#__codelineno-32-225></a><span class=c1>-- CreateTable: ImageGallery</span>
</span><span id=__span-32-226><a id=__codelineno-32-226 name=__codelineno-32-226 href=#__codelineno-32-226></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;ImageGallery&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-227><a id=__codelineno-32-227 name=__codelineno-32-227 href=#__codelineno-32-227></a><span class=w>    </span><span class=ss>&quot;imageId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-228><a id=__codelineno-32-228 name=__codelineno-32-228 href=#__codelineno-32-228></a><span class=w>    </span><span class=ss>&quot;galleryId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-229><a id=__codelineno-32-229 name=__codelineno-32-229 href=#__codelineno-32-229></a>
</span><span id=__span-32-230><a id=__codelineno-32-230 name=__codelineno-32-230 href=#__codelineno-32-230></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;imageId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;galleryId&quot;</span><span class=p>),</span>
</span><span id=__span-32-231><a id=__codelineno-32-231 name=__codelineno-32-231 href=#__codelineno-32-231></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;ImageGallery_imageId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;imageId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-232><a id=__codelineno-32-232 name=__codelineno-32-232 href=#__codelineno-32-232></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;ImageGallery_galleryId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;galleryId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-233><a id=__codelineno-32-233 name=__codelineno-32-233 href=#__codelineno-32-233></a><span class=p>);</span>
</span><span id=__span-32-234><a id=__codelineno-32-234 name=__codelineno-32-234 href=#__codelineno-32-234></a>
</span><span id=__span-32-235><a id=__codelineno-32-235 name=__codelineno-32-235 href=#__codelineno-32-235></a><span class=c1>-- CreateTable: GalleryPerformer</span>
</span><span id=__span-32-236><a id=__codelineno-32-236 name=__codelineno-32-236 href=#__codelineno-32-236></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;GalleryPerformer&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-237><a id=__codelineno-32-237 name=__codelineno-32-237 href=#__codelineno-32-237></a><span class=w>    </span><span class=ss>&quot;galleryId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-238><a id=__codelineno-32-238 name=__codelineno-32-238 href=#__codelineno-32-238></a><span class=w>    </span><span class=ss>&quot;performerId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-239><a id=__codelineno-32-239 name=__codelineno-32-239 href=#__codelineno-32-239></a>
</span><span id=__span-32-240><a id=__codelineno-32-240 name=__codelineno-32-240 href=#__codelineno-32-240></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;galleryId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;performerId&quot;</span><span class=p>),</span>
</span><span id=__span-32-241><a id=__codelineno-32-241 name=__codelineno-32-241 href=#__codelineno-32-241></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;GalleryPerformer_galleryId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;galleryId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-242><a id=__codelineno-32-242 name=__codelineno-32-242 href=#__codelineno-32-242></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;GalleryPerformer_performerId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;performerId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-243><a id=__codelineno-32-243 name=__codelineno-32-243 href=#__codelineno-32-243></a><span class=p>);</span>
</span><span id=__span-32-244><a id=__codelineno-32-244 name=__codelineno-32-244 href=#__codelineno-32-244></a>
</span><span id=__span-32-245><a id=__codelineno-32-245 name=__codelineno-32-245 href=#__codelineno-32-245></a><span class=c1>-- CreateTable: PerformerTag</span>
</span><span id=__span-32-246><a id=__codelineno-32-246 name=__codelineno-32-246 href=#__codelineno-32-246></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;PerformerTag&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-247><a id=__codelineno-32-247 name=__codelineno-32-247 href=#__codelineno-32-247></a><span class=w>    </span><span class=ss>&quot;performerId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-248><a id=__codelineno-32-248 name=__codelineno-32-248 href=#__codelineno-32-248></a><span class=w>    </span><span class=ss>&quot;tagId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-249><a id=__codelineno-32-249 name=__codelineno-32-249 href=#__codelineno-32-249></a>
</span><span id=__span-32-250><a id=__codelineno-32-250 name=__codelineno-32-250 href=#__codelineno-32-250></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;performerId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;tagId&quot;</span><span class=p>),</span>
</span><span id=__span-32-251><a id=__codelineno-32-251 name=__codelineno-32-251 href=#__codelineno-32-251></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;PerformerTag_performerId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;performerId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-252><a id=__codelineno-32-252 name=__codelineno-32-252 href=#__codelineno-32-252></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;PerformerTag_tagId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-253><a id=__codelineno-32-253 name=__codelineno-32-253 href=#__codelineno-32-253></a><span class=p>);</span>
</span><span id=__span-32-254><a id=__codelineno-32-254 name=__codelineno-32-254 href=#__codelineno-32-254></a>
</span><span id=__span-32-255><a id=__codelineno-32-255 name=__codelineno-32-255 href=#__codelineno-32-255></a><span class=c1>-- CreateTable: StudioTag</span>
</span><span id=__span-32-256><a id=__codelineno-32-256 name=__codelineno-32-256 href=#__codelineno-32-256></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;StudioTag&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-257><a id=__codelineno-32-257 name=__codelineno-32-257 href=#__codelineno-32-257></a><span class=w>    </span><span class=ss>&quot;studioId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-258><a id=__codelineno-32-258 name=__codelineno-32-258 href=#__codelineno-32-258></a><span class=w>    </span><span class=ss>&quot;tagId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-259><a id=__codelineno-32-259 name=__codelineno-32-259 href=#__codelineno-32-259></a>
</span><span id=__span-32-260><a id=__codelineno-32-260 name=__codelineno-32-260 href=#__codelineno-32-260></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;studioId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;tagId&quot;</span><span class=p>),</span>
</span><span id=__span-32-261><a id=__codelineno-32-261 name=__codelineno-32-261 href=#__codelineno-32-261></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;StudioTag_studioId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;studioId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashStudio&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-262><a id=__codelineno-32-262 name=__codelineno-32-262 href=#__codelineno-32-262></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;StudioTag_tagId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-263><a id=__codelineno-32-263 name=__codelineno-32-263 href=#__codelineno-32-263></a><span class=p>);</span>
</span><span id=__span-32-264><a id=__codelineno-32-264 name=__codelineno-32-264 href=#__codelineno-32-264></a>
</span><span id=__span-32-265><a id=__codelineno-32-265 name=__codelineno-32-265 href=#__codelineno-32-265></a><span class=c1>-- CreateTable: GalleryTag</span>
</span><span id=__span-32-266><a id=__codelineno-32-266 name=__codelineno-32-266 href=#__codelineno-32-266></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;GalleryTag&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-267><a id=__codelineno-32-267 name=__codelineno-32-267 href=#__codelineno-32-267></a><span class=w>    </span><span class=ss>&quot;galleryId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-268><a id=__codelineno-32-268 name=__codelineno-32-268 href=#__codelineno-32-268></a><span class=w>    </span><span class=ss>&quot;tagId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-269><a id=__codelineno-32-269 name=__codelineno-32-269 href=#__codelineno-32-269></a>
</span><span id=__span-32-270><a id=__codelineno-32-270 name=__codelineno-32-270 href=#__codelineno-32-270></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;galleryId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;tagId&quot;</span><span class=p>),</span>
</span><span id=__span-32-271><a id=__codelineno-32-271 name=__codelineno-32-271 href=#__codelineno-32-271></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;GalleryTag_galleryId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;galleryId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-272><a id=__codelineno-32-272 name=__codelineno-32-272 href=#__codelineno-32-272></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;GalleryTag_tagId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-273><a id=__codelineno-32-273 name=__codelineno-32-273 href=#__codelineno-32-273></a><span class=p>);</span>
</span><span id=__span-32-274><a id=__codelineno-32-274 name=__codelineno-32-274 href=#__codelineno-32-274></a>
</span><span id=__span-32-275><a id=__codelineno-32-275 name=__codelineno-32-275 href=#__codelineno-32-275></a><span class=c1>-- CreateTable: GroupTag</span>
</span><span id=__span-32-276><a id=__codelineno-32-276 name=__codelineno-32-276 href=#__codelineno-32-276></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;GroupTag&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-277><a id=__codelineno-32-277 name=__codelineno-32-277 href=#__codelineno-32-277></a><span class=w>    </span><span class=ss>&quot;groupId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-278><a id=__codelineno-32-278 name=__codelineno-32-278 href=#__codelineno-32-278></a><span class=w>    </span><span class=ss>&quot;tagId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-279><a id=__codelineno-32-279 name=__codelineno-32-279 href=#__codelineno-32-279></a>
</span><span id=__span-32-280><a id=__codelineno-32-280 name=__codelineno-32-280 href=#__codelineno-32-280></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;groupId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;tagId&quot;</span><span class=p>),</span>
</span><span id=__span-32-281><a id=__codelineno-32-281 name=__codelineno-32-281 href=#__codelineno-32-281></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;GroupTag_groupId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;groupId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-32-282><a id=__codelineno-32-282 name=__codelineno-32-282 href=#__codelineno-32-282></a><span class=w>    </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=ss>&quot;GroupTag_tagId_fkey&quot;</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=w> </span><span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>
</span><span id=__span-32-283><a id=__codelineno-32-283 name=__codelineno-32-283 href=#__codelineno-32-283></a><span class=p>);</span>
</span><span id=__span-32-284><a id=__codelineno-32-284 name=__codelineno-32-284 href=#__codelineno-32-284></a>
</span><span id=__span-32-285><a id=__codelineno-32-285 name=__codelineno-32-285 href=#__codelineno-32-285></a><span class=c1>-- CreateTable: SyncState</span>
</span><span id=__span-32-286><a id=__codelineno-32-286 name=__codelineno-32-286 href=#__codelineno-32-286></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;SyncState&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-287><a id=__codelineno-32-287 name=__codelineno-32-287 href=#__codelineno-32-287></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>AUTOINCREMENT</span><span class=p>,</span>
</span><span id=__span-32-288><a id=__codelineno-32-288 name=__codelineno-32-288 href=#__codelineno-32-288></a><span class=w>    </span><span class=ss>&quot;stashInstanceId&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-289><a id=__codelineno-32-289 name=__codelineno-32-289 href=#__codelineno-32-289></a><span class=w>    </span><span class=ss>&quot;entityType&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-32-290><a id=__codelineno-32-290 name=__codelineno-32-290 href=#__codelineno-32-290></a><span class=w>    </span><span class=ss>&quot;lastFullSync&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-291><a id=__codelineno-32-291 name=__codelineno-32-291 href=#__codelineno-32-291></a><span class=w>    </span><span class=ss>&quot;lastIncrementalSync&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=p>,</span>
</span><span id=__span-32-292><a id=__codelineno-32-292 name=__codelineno-32-292 href=#__codelineno-32-292></a><span class=w>    </span><span class=ss>&quot;lastSyncCount&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-32-293><a id=__codelineno-32-293 name=__codelineno-32-293 href=#__codelineno-32-293></a><span class=w>    </span><span class=ss>&quot;lastSyncDurationMs&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-32-294><a id=__codelineno-32-294 name=__codelineno-32-294 href=#__codelineno-32-294></a><span class=w>    </span><span class=ss>&quot;lastError&quot;</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-32-295><a id=__codelineno-32-295 name=__codelineno-32-295 href=#__codelineno-32-295></a><span class=w>    </span><span class=ss>&quot;totalEntities&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-32-296><a id=__codelineno-32-296 name=__codelineno-32-296 href=#__codelineno-32-296></a><span class=p>);</span>
</span><span id=__span-32-297><a id=__codelineno-32-297 name=__codelineno-32-297 href=#__codelineno-32-297></a>
</span><span id=__span-32-298><a id=__codelineno-32-298 name=__codelineno-32-298 href=#__codelineno-32-298></a><span class=c1>-- CreateTable: SyncSettings</span>
</span><span id=__span-32-299><a id=__codelineno-32-299 name=__codelineno-32-299 href=#__codelineno-32-299></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=ss>&quot;SyncSettings&quot;</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-32-300><a id=__codelineno-32-300 name=__codelineno-32-300 href=#__codelineno-32-300></a><span class=w>    </span><span class=ss>&quot;id&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-32-301><a id=__codelineno-32-301 name=__codelineno-32-301 href=#__codelineno-32-301></a><span class=w>    </span><span class=ss>&quot;syncIntervalMinutes&quot;</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>60</span><span class=p>,</span>
</span><span id=__span-32-302><a id=__codelineno-32-302 name=__codelineno-32-302 href=#__codelineno-32-302></a><span class=w>    </span><span class=ss>&quot;enableScanSubscription&quot;</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>true</span><span class=p>,</span>
</span><span id=__span-32-303><a id=__codelineno-32-303 name=__codelineno-32-303 href=#__codelineno-32-303></a><span class=w>    </span><span class=ss>&quot;enablePluginWebhook&quot;</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>false</span><span class=p>,</span>
</span><span id=__span-32-304><a id=__codelineno-32-304 name=__codelineno-32-304 href=#__codelineno-32-304></a><span class=w>    </span><span class=ss>&quot;updatedAt&quot;</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span>
</span><span id=__span-32-305><a id=__codelineno-32-305 name=__codelineno-32-305 href=#__codelineno-32-305></a><span class=p>);</span>
</span><span id=__span-32-306><a id=__codelineno-32-306 name=__codelineno-32-306 href=#__codelineno-32-306></a>
</span><span id=__span-32-307><a id=__codelineno-32-307 name=__codelineno-32-307 href=#__codelineno-32-307></a><span class=c1>-- CreateIndex: StashScene indexes</span>
</span><span id=__span-32-308><a id=__codelineno-32-308 name=__codelineno-32-308 href=#__codelineno-32-308></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_studioId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;studioId&quot;</span><span class=p>);</span>
</span><span id=__span-32-309><a id=__codelineno-32-309 name=__codelineno-32-309 href=#__codelineno-32-309></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_date_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;date&quot;</span><span class=p>);</span>
</span><span id=__span-32-310><a id=__codelineno-32-310 name=__codelineno-32-310 href=#__codelineno-32-310></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_stashCreatedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-311><a id=__codelineno-32-311 name=__codelineno-32-311 href=#__codelineno-32-311></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_stashUpdatedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-312><a id=__codelineno-32-312 name=__codelineno-32-312 href=#__codelineno-32-312></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_rating100_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;rating100&quot;</span><span class=p>);</span>
</span><span id=__span-32-313><a id=__codelineno-32-313 name=__codelineno-32-313 href=#__codelineno-32-313></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_duration_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;duration&quot;</span><span class=p>);</span>
</span><span id=__span-32-314><a id=__codelineno-32-314 name=__codelineno-32-314 href=#__codelineno-32-314></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_deletedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-315><a id=__codelineno-32-315 name=__codelineno-32-315 href=#__codelineno-32-315></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_oCounter_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;oCounter&quot;</span><span class=p>);</span>
</span><span id=__span-32-316><a id=__codelineno-32-316 name=__codelineno-32-316 href=#__codelineno-32-316></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_playCount_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;playCount&quot;</span><span class=p>);</span>
</span><span id=__span-32-317><a id=__codelineno-32-317 name=__codelineno-32-317 href=#__codelineno-32-317></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_browse_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;stashCreatedAt&quot;</span><span class=w> </span><span class=k>DESC</span><span class=p>);</span>
</span><span id=__span-32-318><a id=__codelineno-32-318 name=__codelineno-32-318 href=#__codelineno-32-318></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_browse_updated_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=w> </span><span class=k>DESC</span><span class=p>);</span>
</span><span id=__span-32-319><a id=__codelineno-32-319 name=__codelineno-32-319 href=#__codelineno-32-319></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_browse_date_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;date&quot;</span><span class=w> </span><span class=k>DESC</span><span class=p>);</span>
</span><span id=__span-32-320><a id=__codelineno-32-320 name=__codelineno-32-320 href=#__codelineno-32-320></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_browse_title_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;title&quot;</span><span class=p>);</span>
</span><span id=__span-32-321><a id=__codelineno-32-321 name=__codelineno-32-321 href=#__codelineno-32-321></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashScene_browse_duration_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashScene&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;duration&quot;</span><span class=w> </span><span class=k>DESC</span><span class=p>);</span>
</span><span id=__span-32-322><a id=__codelineno-32-322 name=__codelineno-32-322 href=#__codelineno-32-322></a>
</span><span id=__span-32-323><a id=__codelineno-32-323 name=__codelineno-32-323 href=#__codelineno-32-323></a><span class=c1>-- CreateIndex: StashPerformer indexes</span>
</span><span id=__span-32-324><a id=__codelineno-32-324 name=__codelineno-32-324 href=#__codelineno-32-324></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashPerformer_name_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=p>(</span><span class=ss>&quot;name&quot;</span><span class=p>);</span>
</span><span id=__span-32-325><a id=__codelineno-32-325 name=__codelineno-32-325 href=#__codelineno-32-325></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashPerformer_gender_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=p>(</span><span class=ss>&quot;gender&quot;</span><span class=p>);</span>
</span><span id=__span-32-326><a id=__codelineno-32-326 name=__codelineno-32-326 href=#__codelineno-32-326></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashPerformer_favorite_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=p>(</span><span class=ss>&quot;favorite&quot;</span><span class=p>);</span>
</span><span id=__span-32-327><a id=__codelineno-32-327 name=__codelineno-32-327 href=#__codelineno-32-327></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashPerformer_rating100_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=p>(</span><span class=ss>&quot;rating100&quot;</span><span class=p>);</span>
</span><span id=__span-32-328><a id=__codelineno-32-328 name=__codelineno-32-328 href=#__codelineno-32-328></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashPerformer_stashUpdatedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=p>(</span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-329><a id=__codelineno-32-329 name=__codelineno-32-329 href=#__codelineno-32-329></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashPerformer_deletedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashPerformer&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-330><a id=__codelineno-32-330 name=__codelineno-32-330 href=#__codelineno-32-330></a>
</span><span id=__span-32-331><a id=__codelineno-32-331 name=__codelineno-32-331 href=#__codelineno-32-331></a><span class=c1>-- CreateIndex: StashStudio indexes</span>
</span><span id=__span-32-332><a id=__codelineno-32-332 name=__codelineno-32-332 href=#__codelineno-32-332></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashStudio_name_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashStudio&quot;</span><span class=p>(</span><span class=ss>&quot;name&quot;</span><span class=p>);</span>
</span><span id=__span-32-333><a id=__codelineno-32-333 name=__codelineno-32-333 href=#__codelineno-32-333></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashStudio_parentId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashStudio&quot;</span><span class=p>(</span><span class=ss>&quot;parentId&quot;</span><span class=p>);</span>
</span><span id=__span-32-334><a id=__codelineno-32-334 name=__codelineno-32-334 href=#__codelineno-32-334></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashStudio_favorite_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashStudio&quot;</span><span class=p>(</span><span class=ss>&quot;favorite&quot;</span><span class=p>);</span>
</span><span id=__span-32-335><a id=__codelineno-32-335 name=__codelineno-32-335 href=#__codelineno-32-335></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashStudio_rating100_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashStudio&quot;</span><span class=p>(</span><span class=ss>&quot;rating100&quot;</span><span class=p>);</span>
</span><span id=__span-32-336><a id=__codelineno-32-336 name=__codelineno-32-336 href=#__codelineno-32-336></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashStudio_stashUpdatedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashStudio&quot;</span><span class=p>(</span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-337><a id=__codelineno-32-337 name=__codelineno-32-337 href=#__codelineno-32-337></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashStudio_deletedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashStudio&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-338><a id=__codelineno-32-338 name=__codelineno-32-338 href=#__codelineno-32-338></a>
</span><span id=__span-32-339><a id=__codelineno-32-339 name=__codelineno-32-339 href=#__codelineno-32-339></a><span class=c1>-- CreateIndex: StashTag indexes</span>
</span><span id=__span-32-340><a id=__codelineno-32-340 name=__codelineno-32-340 href=#__codelineno-32-340></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashTag_name_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=p>(</span><span class=ss>&quot;name&quot;</span><span class=p>);</span>
</span><span id=__span-32-341><a id=__codelineno-32-341 name=__codelineno-32-341 href=#__codelineno-32-341></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashTag_favorite_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=p>(</span><span class=ss>&quot;favorite&quot;</span><span class=p>);</span>
</span><span id=__span-32-342><a id=__codelineno-32-342 name=__codelineno-32-342 href=#__codelineno-32-342></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashTag_stashUpdatedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=p>(</span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-343><a id=__codelineno-32-343 name=__codelineno-32-343 href=#__codelineno-32-343></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashTag_deletedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashTag&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-344><a id=__codelineno-32-344 name=__codelineno-32-344 href=#__codelineno-32-344></a>
</span><span id=__span-32-345><a id=__codelineno-32-345 name=__codelineno-32-345 href=#__codelineno-32-345></a><span class=c1>-- CreateIndex: StashGroup indexes</span>
</span><span id=__span-32-346><a id=__codelineno-32-346 name=__codelineno-32-346 href=#__codelineno-32-346></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGroup_name_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=p>(</span><span class=ss>&quot;name&quot;</span><span class=p>);</span>
</span><span id=__span-32-347><a id=__codelineno-32-347 name=__codelineno-32-347 href=#__codelineno-32-347></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGroup_date_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=p>(</span><span class=ss>&quot;date&quot;</span><span class=p>);</span>
</span><span id=__span-32-348><a id=__codelineno-32-348 name=__codelineno-32-348 href=#__codelineno-32-348></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGroup_studioId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=p>(</span><span class=ss>&quot;studioId&quot;</span><span class=p>);</span>
</span><span id=__span-32-349><a id=__codelineno-32-349 name=__codelineno-32-349 href=#__codelineno-32-349></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGroup_rating100_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=p>(</span><span class=ss>&quot;rating100&quot;</span><span class=p>);</span>
</span><span id=__span-32-350><a id=__codelineno-32-350 name=__codelineno-32-350 href=#__codelineno-32-350></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGroup_stashUpdatedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=p>(</span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-351><a id=__codelineno-32-351 name=__codelineno-32-351 href=#__codelineno-32-351></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGroup_deletedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGroup&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-352><a id=__codelineno-32-352 name=__codelineno-32-352 href=#__codelineno-32-352></a>
</span><span id=__span-32-353><a id=__codelineno-32-353 name=__codelineno-32-353 href=#__codelineno-32-353></a><span class=c1>-- CreateIndex: StashGallery indexes</span>
</span><span id=__span-32-354><a id=__codelineno-32-354 name=__codelineno-32-354 href=#__codelineno-32-354></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGallery_title_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=p>(</span><span class=ss>&quot;title&quot;</span><span class=p>);</span>
</span><span id=__span-32-355><a id=__codelineno-32-355 name=__codelineno-32-355 href=#__codelineno-32-355></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGallery_date_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=p>(</span><span class=ss>&quot;date&quot;</span><span class=p>);</span>
</span><span id=__span-32-356><a id=__codelineno-32-356 name=__codelineno-32-356 href=#__codelineno-32-356></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGallery_studioId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=p>(</span><span class=ss>&quot;studioId&quot;</span><span class=p>);</span>
</span><span id=__span-32-357><a id=__codelineno-32-357 name=__codelineno-32-357 href=#__codelineno-32-357></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGallery_rating100_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=p>(</span><span class=ss>&quot;rating100&quot;</span><span class=p>);</span>
</span><span id=__span-32-358><a id=__codelineno-32-358 name=__codelineno-32-358 href=#__codelineno-32-358></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGallery_stashUpdatedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=p>(</span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-359><a id=__codelineno-32-359 name=__codelineno-32-359 href=#__codelineno-32-359></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashGallery_deletedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashGallery&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-360><a id=__codelineno-32-360 name=__codelineno-32-360 href=#__codelineno-32-360></a>
</span><span id=__span-32-361><a id=__codelineno-32-361 name=__codelineno-32-361 href=#__codelineno-32-361></a><span class=c1>-- CreateIndex: StashImage indexes</span>
</span><span id=__span-32-362><a id=__codelineno-32-362 name=__codelineno-32-362 href=#__codelineno-32-362></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashImage_studioId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=p>(</span><span class=ss>&quot;studioId&quot;</span><span class=p>);</span>
</span><span id=__span-32-363><a id=__codelineno-32-363 name=__codelineno-32-363 href=#__codelineno-32-363></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashImage_date_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=p>(</span><span class=ss>&quot;date&quot;</span><span class=p>);</span>
</span><span id=__span-32-364><a id=__codelineno-32-364 name=__codelineno-32-364 href=#__codelineno-32-364></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashImage_rating100_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=p>(</span><span class=ss>&quot;rating100&quot;</span><span class=p>);</span>
</span><span id=__span-32-365><a id=__codelineno-32-365 name=__codelineno-32-365 href=#__codelineno-32-365></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashImage_stashUpdatedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=p>(</span><span class=ss>&quot;stashUpdatedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-366><a id=__codelineno-32-366 name=__codelineno-32-366 href=#__codelineno-32-366></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StashImage_deletedAt_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StashImage&quot;</span><span class=p>(</span><span class=ss>&quot;deletedAt&quot;</span><span class=p>);</span>
</span><span id=__span-32-367><a id=__codelineno-32-367 name=__codelineno-32-367 href=#__codelineno-32-367></a>
</span><span id=__span-32-368><a id=__codelineno-32-368 name=__codelineno-32-368 href=#__codelineno-32-368></a><span class=c1>-- CreateIndex: Junction table indexes</span>
</span><span id=__span-32-369><a id=__codelineno-32-369 name=__codelineno-32-369 href=#__codelineno-32-369></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;ScenePerformer_performerId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;ScenePerformer&quot;</span><span class=p>(</span><span class=ss>&quot;performerId&quot;</span><span class=p>);</span>
</span><span id=__span-32-370><a id=__codelineno-32-370 name=__codelineno-32-370 href=#__codelineno-32-370></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;SceneTag_tagId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;SceneTag&quot;</span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>);</span>
</span><span id=__span-32-371><a id=__codelineno-32-371 name=__codelineno-32-371 href=#__codelineno-32-371></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;SceneGroup_groupId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;SceneGroup&quot;</span><span class=p>(</span><span class=ss>&quot;groupId&quot;</span><span class=p>);</span>
</span><span id=__span-32-372><a id=__codelineno-32-372 name=__codelineno-32-372 href=#__codelineno-32-372></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;SceneGallery_galleryId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;SceneGallery&quot;</span><span class=p>(</span><span class=ss>&quot;galleryId&quot;</span><span class=p>);</span>
</span><span id=__span-32-373><a id=__codelineno-32-373 name=__codelineno-32-373 href=#__codelineno-32-373></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;ImagePerformer_performerId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;ImagePerformer&quot;</span><span class=p>(</span><span class=ss>&quot;performerId&quot;</span><span class=p>);</span>
</span><span id=__span-32-374><a id=__codelineno-32-374 name=__codelineno-32-374 href=#__codelineno-32-374></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;ImageTag_tagId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;ImageTag&quot;</span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>);</span>
</span><span id=__span-32-375><a id=__codelineno-32-375 name=__codelineno-32-375 href=#__codelineno-32-375></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;ImageGallery_galleryId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;ImageGallery&quot;</span><span class=p>(</span><span class=ss>&quot;galleryId&quot;</span><span class=p>);</span>
</span><span id=__span-32-376><a id=__codelineno-32-376 name=__codelineno-32-376 href=#__codelineno-32-376></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;GalleryPerformer_performerId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;GalleryPerformer&quot;</span><span class=p>(</span><span class=ss>&quot;performerId&quot;</span><span class=p>);</span>
</span><span id=__span-32-377><a id=__codelineno-32-377 name=__codelineno-32-377 href=#__codelineno-32-377></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;PerformerTag_tagId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;PerformerTag&quot;</span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>);</span>
</span><span id=__span-32-378><a id=__codelineno-32-378 name=__codelineno-32-378 href=#__codelineno-32-378></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;StudioTag_tagId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;StudioTag&quot;</span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>);</span>
</span><span id=__span-32-379><a id=__codelineno-32-379 name=__codelineno-32-379 href=#__codelineno-32-379></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;GalleryTag_tagId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;GalleryTag&quot;</span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>);</span>
</span><span id=__span-32-380><a id=__codelineno-32-380 name=__codelineno-32-380 href=#__codelineno-32-380></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;GroupTag_tagId_idx&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;GroupTag&quot;</span><span class=p>(</span><span class=ss>&quot;tagId&quot;</span><span class=p>);</span>
</span><span id=__span-32-381><a id=__codelineno-32-381 name=__codelineno-32-381 href=#__codelineno-32-381></a>
</span><span id=__span-32-382><a id=__codelineno-32-382 name=__codelineno-32-382 href=#__codelineno-32-382></a><span class=c1>-- CreateIndex: SyncState unique constraint</span>
</span><span id=__span-32-383><a id=__codelineno-32-383 name=__codelineno-32-383 href=#__codelineno-32-383></a><span class=k>CREATE</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=ss>&quot;SyncState_stashInstanceId_entityType_key&quot;</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;SyncState&quot;</span><span class=p>(</span><span class=ss>&quot;stashInstanceId&quot;</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;entityType&quot;</span><span class=p>);</span>
</span><span id=__span-32-384><a id=__codelineno-32-384 name=__codelineno-32-384 href=#__codelineno-32-384></a>
</span><span id=__span-32-385><a id=__codelineno-32-385 name=__codelineno-32-385 href=#__codelineno-32-385></a><span class=c1>-- FTS5 Virtual Table for scene search</span>
</span><span id=__span-32-386><a id=__codelineno-32-386 name=__codelineno-32-386 href=#__codelineno-32-386></a><span class=k>CREATE</span><span class=w> </span><span class=n>VIRTUAL</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>scene_fts</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>fts5</span><span class=p>(</span>
</span><span id=__span-32-387><a id=__codelineno-32-387 name=__codelineno-32-387 href=#__codelineno-32-387></a><span class=w>    </span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-32-388><a id=__codelineno-32-388 name=__codelineno-32-388 href=#__codelineno-32-388></a><span class=w>    </span><span class=n>title</span><span class=p>,</span>
</span><span id=__span-32-389><a id=__codelineno-32-389 name=__codelineno-32-389 href=#__codelineno-32-389></a><span class=w>    </span><span class=n>details</span><span class=p>,</span>
</span><span id=__span-32-390><a id=__codelineno-32-390 name=__codelineno-32-390 href=#__codelineno-32-390></a><span class=w>    </span><span class=n>code</span><span class=p>,</span>
</span><span id=__span-32-391><a id=__codelineno-32-391 name=__codelineno-32-391 href=#__codelineno-32-391></a><span class=w>    </span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;StashScene&#39;</span><span class=p>,</span>
</span><span id=__span-32-392><a id=__codelineno-32-392 name=__codelineno-32-392 href=#__codelineno-32-392></a><span class=w>    </span><span class=n>content_rowid</span><span class=o>=</span><span class=s1>&#39;rowid&#39;</span>
</span><span id=__span-32-393><a id=__codelineno-32-393 name=__codelineno-32-393 href=#__codelineno-32-393></a><span class=p>);</span>
</span><span id=__span-32-394><a id=__codelineno-32-394 name=__codelineno-32-394 href=#__codelineno-32-394></a>
</span><span id=__span-32-395><a id=__codelineno-32-395 name=__codelineno-32-395 href=#__codelineno-32-395></a><span class=c1>-- FTS5 Triggers for automatic sync</span>
</span><span id=__span-32-396><a id=__codelineno-32-396 name=__codelineno-32-396 href=#__codelineno-32-396></a><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>scene_fts_insert</span><span class=w> </span><span class=k>AFTER</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>StashScene</span><span class=w> </span><span class=k>BEGIN</span>
</span><span id=__span-32-397><a id=__codelineno-32-397 name=__codelineno-32-397 href=#__codelineno-32-397></a><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>scene_fts</span><span class=p>(</span><span class=n>rowid</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=n>code</span><span class=p>)</span>
</span><span id=__span-32-398><a id=__codelineno-32-398 name=__codelineno-32-398 href=#__codelineno-32-398></a><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=k>NEW</span><span class=p>.</span><span class=n>rowid</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>code</span><span class=p>);</span>
</span><span id=__span-32-399><a id=__codelineno-32-399 name=__codelineno-32-399 href=#__codelineno-32-399></a><span class=k>END</span><span class=p>;</span>
</span><span id=__span-32-400><a id=__codelineno-32-400 name=__codelineno-32-400 href=#__codelineno-32-400></a>
</span><span id=__span-32-401><a id=__codelineno-32-401 name=__codelineno-32-401 href=#__codelineno-32-401></a><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>scene_fts_delete</span><span class=w> </span><span class=k>AFTER</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>StashScene</span><span class=w> </span><span class=k>BEGIN</span>
</span><span id=__span-32-402><a id=__codelineno-32-402 name=__codelineno-32-402 href=#__codelineno-32-402></a><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>scene_fts</span><span class=p>(</span><span class=n>scene_fts</span><span class=p>,</span><span class=w> </span><span class=n>rowid</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=n>code</span><span class=p>)</span>
</span><span id=__span-32-403><a id=__codelineno-32-403 name=__codelineno-32-403 href=#__codelineno-32-403></a><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;delete&#39;</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>rowid</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>code</span><span class=p>);</span>
</span><span id=__span-32-404><a id=__codelineno-32-404 name=__codelineno-32-404 href=#__codelineno-32-404></a><span class=k>END</span><span class=p>;</span>
</span><span id=__span-32-405><a id=__codelineno-32-405 name=__codelineno-32-405 href=#__codelineno-32-405></a>
</span><span id=__span-32-406><a id=__codelineno-32-406 name=__codelineno-32-406 href=#__codelineno-32-406></a><span class=k>CREATE</span><span class=w> </span><span class=k>TRIGGER</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>scene_fts_update</span><span class=w> </span><span class=k>AFTER</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>StashScene</span><span class=w> </span><span class=k>BEGIN</span>
</span><span id=__span-32-407><a id=__codelineno-32-407 name=__codelineno-32-407 href=#__codelineno-32-407></a><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>scene_fts</span><span class=p>(</span><span class=n>scene_fts</span><span class=p>,</span><span class=w> </span><span class=n>rowid</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=n>code</span><span class=p>)</span>
</span><span id=__span-32-408><a id=__codelineno-32-408 name=__codelineno-32-408 href=#__codelineno-32-408></a><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;delete&#39;</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>rowid</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=k>OLD</span><span class=p>.</span><span class=n>code</span><span class=p>);</span>
</span><span id=__span-32-409><a id=__codelineno-32-409 name=__codelineno-32-409 href=#__codelineno-32-409></a><span class=w>    </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>scene_fts</span><span class=p>(</span><span class=n>rowid</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=n>code</span><span class=p>)</span>
</span><span id=__span-32-410><a id=__codelineno-32-410 name=__codelineno-32-410 href=#__codelineno-32-410></a><span class=w>    </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=k>NEW</span><span class=p>.</span><span class=n>rowid</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=k>NEW</span><span class=p>.</span><span class=n>code</span><span class=p>);</span>
</span><span id=__span-32-411><a id=__codelineno-32-411 name=__codelineno-32-411 href=#__codelineno-32-411></a><span class=k>END</span><span class=p>;</span>
</span></code></pre></div> <p><strong>Step 3: Verify migration file exists</strong></p> <p>Run: <code>ls -la server/prisma/migrations/20251211000000_stash_entities/</code> Expected: migration.sql file present</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>git<span class=w> </span>add<span class=w> </span>server/prisma/migrations/20251211000000_stash_entities/
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;feat: add squashed stash_entities migration&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-8-verify-prisma-schema-consistency>Task 8: Verify Prisma Schema Consistency<a class=headerlink href=#task-8-verify-prisma-schema-consistency title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Test: <code>server/prisma/schema.prisma</code></p> <p><strong>Step 1: Format schema</strong></p> <p>Run: <code>cd server &amp;&amp; npx prisma format</code> Expected: Schema formatted successfully</p> <p><strong>Step 2: Validate schema</strong></p> <p>Run: <code>cd server &amp;&amp; npx prisma validate</code> Expected: "The Prisma schema is valid."</p> <p><strong>Step 3: Generate Prisma client</strong></p> <p>Run: <code>cd server &amp;&amp; npx prisma generate</code> Expected: "Generated Prisma Client"</p> <p><strong>Step 4: Commit any formatting changes</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>git<span class=w> </span>add<span class=w> </span>server/prisma/schema.prisma
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;style: format prisma schema&quot;</span><span class=w> </span>--allow-empty
</span></code></pre></div> <hr> <h2 id=session-2-server-code-refactor>Session 2: Server Code Refactor<a class=headerlink href=#session-2-server-code-refactor title="Permanent link">&para;</a></h2> <h3 id=task-9-rename-pathmappingts-to-stashurlproxyts>Task 9: Rename pathMapping.ts to stashUrlProxy.ts<a class=headerlink href=#task-9-rename-pathmappingts-to-stashurlproxyts title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Rename: <code>server/utils/pathMapping.ts</code> -&gt; <code>server/utils/stashUrlProxy.ts</code> - Modify: <code>server/controllers/playlist.ts</code> - Modify: <code>server/controllers/library/galleries.ts</code> - Modify: <code>server/controllers/library/images.ts</code> - Modify: <code>server/services/StashCacheManager.ts</code> - Modify: <code>server/services/__tests__/StashSyncService.integration.test.ts</code></p> <p><strong>Step 1: Rename the file</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>git<span class=w> </span>mv<span class=w> </span>server/utils/pathMapping.ts<span class=w> </span>server/utils/stashUrlProxy.ts
</span></code></pre></div> <p><strong>Step 2: Update import in server/controllers/playlist.ts</strong></p> <p>Find: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>transformScene</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../utils/pathMapping.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p>Replace: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>transformScene</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../utils/stashUrlProxy.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Step 3: Update import in server/controllers/library/galleries.ts</strong></p> <p>Find: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>transformGallery</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../utils/pathMapping.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p>Replace: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>transformGallery</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../utils/stashUrlProxy.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Step 4: Update import in server/controllers/library/images.ts</strong></p> <p>Find: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>transformImage</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../utils/pathMapping.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p>Replace: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>transformImage</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../utils/stashUrlProxy.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Step 5: Update import in server/services/StashCacheManager.ts</strong></p> <p>Find: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../utils/pathMapping.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p>Replace: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../utils/stashUrlProxy.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Step 6: Update import in StashSyncService.integration.test.ts</strong></p> <p>Find: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../utils/pathMapping.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p>Replace: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../utils/stashUrlProxy.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Step 7: Search for any other references</strong></p> <p>Run: <code>cd server &amp;&amp; grep -r "pathMapping" --include="*.ts" --include="*.js"</code> Expected: No results (all imports updated)</p> <p><strong>Step 8: Verify TypeScript compiles</strong></p> <p>Run: <code>cd server &amp;&amp; npx tsc --noEmit</code> Expected: No errors</p> <p><strong>Step 9: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: rename pathMapping.ts to stashUrlProxy.ts&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-10-update-cachedentityqueryservice-rename-to-stashentityservice>Task 10: Update CachedEntityQueryService - Rename to StashEntityService<a class=headerlink href=#task-10-update-cachedentityqueryservice-rename-to-stashentityservice title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Rename: <code>server/services/CachedEntityQueryService.ts</code> -&gt; <code>server/services/StashEntityService.ts</code> - Modify: All files that import CachedEntityQueryService</p> <p><strong>Step 1: Rename the file</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>git<span class=w> </span>mv<span class=w> </span>server/services/CachedEntityQueryService.ts<span class=w> </span>server/services/StashEntityService.ts
</span></code></pre></div> <p><strong>Step 2: Update class name and export in the renamed file</strong></p> <p>Find: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=kd>class</span><span class=w> </span><span class=nx>CachedEntityQueryService</span><span class=w> </span><span class=p>{</span>
</span></code></pre></div></p> <p>Replace: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=kd>class</span><span class=w> </span><span class=nx>StashEntityService</span><span class=w> </span><span class=p>{</span>
</span></code></pre></div></p> <p>Find: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>cachedEntityQueryService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>CachedEntityQueryService</span><span class=p>();</span>
</span></code></pre></div></p> <p>Replace: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>stashEntityService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>StashEntityService</span><span class=p>();</span>
</span></code></pre></div></p> <p><strong>Step 3: Update all table references in StashEntityService.ts</strong></p> <p>Replace all occurrences: - <code>CachedScene</code> -&gt; <code>StashScene</code> - <code>CachedPerformer</code> -&gt; <code>StashPerformer</code> - <code>CachedStudio</code> -&gt; <code>StashStudio</code> - <code>CachedTag</code> -&gt; <code>StashTag</code> - <code>CachedGroup</code> -&gt; <code>StashGroup</code> - <code>CachedGallery</code> -&gt; <code>StashGallery</code> - <code>CachedImage</code> -&gt; <code>StashImage</code> - <code>cachedScene</code> -&gt; <code>stashScene</code> - <code>cachedPerformer</code> -&gt; <code>stashPerformer</code> - <code>cachedStudio</code> -&gt; <code>stashStudio</code> - <code>cachedTag</code> -&gt; <code>stashTag</code> - <code>cachedGroup</code> -&gt; <code>stashGroup</code> - <code>cachedGallery</code> -&gt; <code>stashGallery</code> - <code>cachedImage</code> -&gt; <code>stashImage</code></p> <p><strong>Step 4: Update imports across codebase</strong></p> <p>Search and replace in all .ts files: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=c1>// Old</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>cachedEntityQueryService</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./CachedEntityQueryService.js&quot;</span><span class=p>;</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>cachedEntityQueryService</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../services/CachedEntityQueryService.js&quot;</span><span class=p>;</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=c1>// New</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>stashEntityService</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./StashEntityService.js&quot;</span><span class=p>;</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>stashEntityService</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../services/StashEntityService.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Step 5: Verify TypeScript compiles</strong></p> <p>Run: <code>cd server &amp;&amp; npx tsc --noEmit</code> Expected: No errors</p> <p><strong>Step 6: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: rename CachedEntityQueryService to StashEntityService&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-11-update-stashsyncservice-table-references>Task 11: Update StashSyncService - Table References<a class=headerlink href=#task-11-update-stashsyncservice-table-references title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/services/StashSyncService.ts</code></p> <p><strong>Step 1: Update all Prisma table references</strong></p> <p>Replace all occurrences: - <code>prisma.cachedScene</code> -&gt; <code>prisma.stashScene</code> - <code>prisma.cachedPerformer</code> -&gt; <code>prisma.stashPerformer</code> - <code>prisma.cachedStudio</code> -&gt; <code>prisma.stashStudio</code> - <code>prisma.cachedTag</code> -&gt; <code>prisma.stashTag</code> - <code>prisma.cachedGroup</code> -&gt; <code>prisma.stashGroup</code> - <code>prisma.cachedGallery</code> -&gt; <code>prisma.stashGallery</code> - <code>prisma.cachedImage</code> -&gt; <code>prisma.stashImage</code></p> <p><strong>Step 2: Update SQL string references</strong></p> <p>Replace in raw SQL queries: - <code>"CachedScene"</code> -&gt; <code>"StashScene"</code> - <code>"CachedPerformer"</code> -&gt; <code>"StashPerformer"</code> - <code>"CachedStudio"</code> -&gt; <code>"StashStudio"</code> - <code>"CachedTag"</code> -&gt; <code>"StashTag"</code> - <code>"CachedGroup"</code> -&gt; <code>"StashGroup"</code> - <code>"CachedGallery"</code> -&gt; <code>"StashGallery"</code> - <code>"CachedImage"</code> -&gt; <code>"StashImage"</code></p> <p><strong>Step 3: Remove count field updates</strong></p> <p>Remove any code that updates: - <code>sceneCount</code> - <code>imageCount</code> - <code>galleryCount</code> - <code>groupCount</code> - <code>performerCount</code> - <code>studioCount</code> - <code>sceneMarkerCount</code></p> <p><strong>Step 4: Add tag junction table syncing</strong></p> <p>When syncing performers/studios/groups/galleries, add code to sync their tags to the new junction tables (PerformerTag, StudioTag, GroupTag, GalleryTag).</p> <p><strong>Step 5: Verify TypeScript compiles</strong></p> <p>Run: <code>cd server &amp;&amp; npx tsc --noEmit</code> Expected: No errors</p> <p><strong>Step 6: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a>git<span class=w> </span>add<span class=w> </span>server/services/StashSyncService.ts
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: update StashSyncService for new table names and junction tables&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-12-update-scenequerybuilder-table-references>Task 12: Update SceneQueryBuilder - Table References<a class=headerlink href=#task-12-update-scenequerybuilder-table-references title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/services/SceneQueryBuilder.ts</code></p> <p><strong>Step 1: Update all SQL table references</strong></p> <p>Replace all occurrences: - <code>CachedScene</code> -&gt; <code>StashScene</code> - <code>CachedPerformer</code> -&gt; <code>StashPerformer</code> - <code>CachedStudio</code> -&gt; <code>StashStudio</code> - <code>CachedTag</code> -&gt; <code>StashTag</code> - <code>CachedGroup</code> -&gt; <code>StashGroup</code> - <code>CachedGallery</code> -&gt; <code>StashGallery</code> - <code>CachedImage</code> -&gt; <code>StashImage</code></p> <p><strong>Step 2: Verify TypeScript compiles</strong></p> <p>Run: <code>cd server &amp;&amp; npx tsc --noEmit</code> Expected: No errors</p> <p><strong>Step 3: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a>git<span class=w> </span>add<span class=w> </span>server/services/SceneQueryBuilder.ts
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: update SceneQueryBuilder for new table names&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-13-update-userrestrictionservice-table-references>Task 13: Update UserRestrictionService - Table References<a class=headerlink href=#task-13-update-userrestrictionservice-table-references title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/services/UserRestrictionService.ts</code></p> <p><strong>Step 1: Update all SQL table references</strong></p> <p>Replace all occurrences: - <code>CachedScene</code> -&gt; <code>StashScene</code> - <code>CachedPerformer</code> -&gt; <code>StashPerformer</code> - <code>CachedStudio</code> -&gt; <code>StashStudio</code> - <code>CachedTag</code> -&gt; <code>StashTag</code> - <code>CachedGroup</code> -&gt; <code>StashGroup</code> - <code>CachedGallery</code> -&gt; <code>StashGallery</code> - <code>CachedImage</code> -&gt; <code>StashImage</code></p> <p><strong>Step 2: Verify TypeScript compiles</strong></p> <p>Run: <code>cd server &amp;&amp; npx tsc --noEmit</code> Expected: No errors</p> <p><strong>Step 3: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>git<span class=w> </span>add<span class=w> </span>server/services/UserRestrictionService.ts
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: update UserRestrictionService for new table names&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-14-update-stashcachemanager-table-references>Task 14: Update StashCacheManager - Table References<a class=headerlink href=#task-14-update-stashcachemanager-table-references title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/services/StashCacheManager.ts</code></p> <p><strong>Step 1: Update all Prisma table references</strong></p> <p>Replace all occurrences: - <code>prisma.cachedScene</code> -&gt; <code>prisma.stashScene</code> - <code>prisma.cachedPerformer</code> -&gt; <code>prisma.stashPerformer</code> - <code>prisma.cachedStudio</code> -&gt; <code>prisma.stashStudio</code> - <code>prisma.cachedTag</code> -&gt; <code>prisma.stashTag</code> - <code>prisma.cachedGroup</code> -&gt; <code>prisma.stashGroup</code> - <code>prisma.cachedGallery</code> -&gt; <code>prisma.stashGallery</code> - <code>prisma.cachedImage</code> -&gt; <code>prisma.stashImage</code></p> <p><strong>Step 2: Verify TypeScript compiles</strong></p> <p>Run: <code>cd server &amp;&amp; npx tsc --noEmit</code> Expected: No errors</p> <p><strong>Step 3: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>git<span class=w> </span>add<span class=w> </span>server/services/StashCacheManager.ts
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: update StashCacheManager for new table names&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-15-update-library-controllers-import-changes>Task 15: Update Library Controllers - Import Changes<a class=headerlink href=#task-15-update-library-controllers-import-changes title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/controllers/library/scenes.ts</code> - Modify: <code>server/controllers/library/performers.ts</code> - Modify: <code>server/controllers/library/studios.ts</code> - Modify: <code>server/controllers/library/tags.ts</code> - Modify: <code>server/controllers/library/galleries.ts</code> - Modify: <code>server/controllers/library/groups.ts</code> - Modify: <code>server/controllers/library/images.ts</code></p> <p><strong>Step 1: Update imports to use stashEntityService</strong></p> <p>In each file, change: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>cachedEntityQueryService</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../services/CachedEntityQueryService.js&quot;</span><span class=p>;</span>
</span></code></pre></div> To: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>stashEntityService</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../../services/StashEntityService.js&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Step 2: Update service calls</strong></p> <p>Replace all <code>cachedEntityQueryService.</code> with <code>stashEntityService.</code></p> <p><strong>Step 3: Verify TypeScript compiles</strong></p> <p>Run: <code>cd server &amp;&amp; npx tsc --noEmit</code> Expected: No errors</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a>git<span class=w> </span>add<span class=w> </span>server/controllers/library/
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: update library controllers to use StashEntityService&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-16-update-other-services-and-controllers>Task 16: Update Other Services and Controllers<a class=headerlink href=#task-16-update-other-services-and-controllers title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/services/FilteredEntityCacheService.ts</code> - Modify: <code>server/services/UserHiddenEntityService.ts</code> - Modify: <code>server/services/UserStatsService.ts</code> - Modify: <code>server/services/SyncScheduler.ts</code> - Modify: <code>server/controllers/sync.ts</code> - Modify: Any other files referencing old names</p> <p><strong>Step 1: Search for all remaining references</strong></p> <p>Run: <code>cd server &amp;&amp; grep -r "CachedEntityQueryService\|cachedEntityQueryService\|CachedScene\|CachedPerformer\|CachedStudio\|CachedTag\|CachedGroup\|CachedGallery\|CachedImage" --include="*.ts"</code></p> <p><strong>Step 2: Update each file found</strong></p> <p>For each file with old references: - Update imports - Update table/service references</p> <p><strong>Step 3: Verify TypeScript compiles</strong></p> <p>Run: <code>cd server &amp;&amp; npx tsc --noEmit</code> Expected: No errors</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: update remaining services for new naming convention&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-17-update-tests-table-and-service-references>Task 17: Update Tests - Table and Service References<a class=headerlink href=#task-17-update-tests-table-and-service-references title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>server/services/__tests__/CachedEntityQueryService.test.ts</code> -&gt; rename and update - Modify: <code>server/services/__tests__/StashSyncService.integration.test.ts</code> - Modify: <code>server/tests/services/SceneQueryBuilder.test.ts</code> - Modify: <code>server/tests/services/SceneQueryBuilder.integration.test.ts</code> - Modify: Other test files</p> <p><strong>Step 1: Rename CachedEntityQueryService.test.ts</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a>git<span class=w> </span>mv<span class=w> </span>server/services/__tests__/CachedEntityQueryService.test.ts<span class=w> </span>server/services/__tests__/StashEntityService.test.ts
</span></code></pre></div> <p><strong>Step 2: Update test file imports and references</strong></p> <p>In the renamed test file: - Update import to use <code>StashEntityService</code> - Update mock table names to <code>StashScene</code>, etc. - Update variable names</p> <p><strong>Step 3: Update other test files</strong></p> <p>Search and update all test files for table name references.</p> <p><strong>Step 4: Run tests</strong></p> <p>Run: <code>cd server &amp;&amp; npm test</code> Expected: All tests pass (or skip integration tests as expected)</p> <p><strong>Step 5: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;test: update tests for new naming convention&quot;</span>
</span></code></pre></div> <hr> <h2 id=session-3-client-updates>Session 3: Client Updates<a class=headerlink href=#session-3-client-updates title="Permanent link">&para;</a></h2> <h3 id=task-18-rename-cacheloadingbanner-to-syncprogressbanner>Task 18: Rename CacheLoadingBanner to SyncProgressBanner<a class=headerlink href=#task-18-rename-cacheloadingbanner-to-syncprogressbanner title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Rename: <code>client/src/components/ui/CacheLoadingBanner.jsx</code> -&gt; <code>client/src/components/ui/SyncProgressBanner.jsx</code> - Modify: All files that import CacheLoadingBanner</p> <p><strong>Step 1: Rename the file</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a>git<span class=w> </span>mv<span class=w> </span>client/src/components/ui/CacheLoadingBanner.jsx<span class=w> </span>client/src/components/ui/SyncProgressBanner.jsx
</span></code></pre></div> <p><strong>Step 2: Update component name and default export</strong></p> <p>In the renamed file, change: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=kd>const</span><span class=w> </span><span class=nx>CacheLoadingBanner</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>({</span><span class=w> </span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>className</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span></code></pre></div> To: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=kd>const</span><span class=w> </span><span class=nx>SyncProgressBanner</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>({</span><span class=w> </span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>className</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span></code></pre></div></p> <p>And: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=nx>CacheLoadingBanner</span><span class=p>;</span>
</span></code></pre></div> To: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=nx>SyncProgressBanner</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Step 3: Update default message text</strong></p> <p>Change: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=p>{</span><span class=nx>message</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s2>&quot;Server is loading cache, please wait...&quot;</span><span class=p>}</span>
</span></code></pre></div> To: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=p>{</span><span class=nx>message</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s2>&quot;Syncing library, please wait...&quot;</span><span class=p>}</span>
</span></code></pre></div></p> <p>Change: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=nx>This</span><span class=w> </span><span class=nx>may</span><span class=w> </span><span class=nx>take</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=nx>minute</span><span class=w> </span><span class=nx>on</span><span class=w> </span><span class=nx>first</span><span class=w> </span><span class=nx>startup</span><span class=p>.</span><span class=w> </span><span class=nx>Checking</span><span class=w> </span><span class=nx>every</span><span class=w> </span><span class=mf>5</span><span class=w> </span><span class=nx>seconds</span><span class=p>...</span>
</span></code></pre></div> To: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=nx>This</span><span class=w> </span><span class=nx>may</span><span class=w> </span><span class=nx>take</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=nx>minute</span><span class=w> </span><span class=nx>on</span><span class=w> </span><span class=nx>first</span><span class=w> </span><span class=nx>sync</span><span class=p>.</span><span class=w> </span><span class=nx>Checking</span><span class=w> </span><span class=nx>every</span><span class=w> </span><span class=mf>5</span><span class=w> </span><span class=nx>seconds</span><span class=p>...</span>
</span></code></pre></div></p> <p><strong>Step 4: Search for imports and update</strong></p> <p>Run: <code>cd client &amp;&amp; grep -r "CacheLoadingBanner" --include="*.jsx" --include="*.tsx" --include="*.js"</code></p> <p>Update each import found: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=c1>// Old</span>
</span><span id=__span-73-2><a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a><span class=k>import</span><span class=w> </span><span class=nx>CacheLoadingBanner</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../components/ui/CacheLoadingBanner&quot;</span><span class=p>;</span>
</span><span id=__span-73-3><a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a><span class=c1>// New</span>
</span><span id=__span-73-4><a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a><span class=k>import</span><span class=w> </span><span class=nx>SyncProgressBanner</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../components/ui/SyncProgressBanner&quot;</span><span class=p>;</span>
</span></code></pre></div></p> <p>And update JSX usage: <div class="language-jsx highlight"><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=c1>// Old</span>
</span><span id=__span-74-2><a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a><span class=p>&lt;</span><span class=nt>CacheLoadingBanner</span><span class=w> </span><span class=p>/&gt;</span>
</span><span id=__span-74-3><a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=c1>// New</span>
</span><span id=__span-74-4><a id=__codelineno-74-4 name=__codelineno-74-4 href=#__codelineno-74-4></a><span class=p>&lt;</span><span class=nt>SyncProgressBanner</span><span class=w> </span><span class=p>/&gt;</span>
</span></code></pre></div></p> <p><strong>Step 5: Verify client builds</strong></p> <p>Run: <code>cd client &amp;&amp; npm run build</code> Expected: Build succeeds</p> <p><strong>Step 6: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: rename CacheLoadingBanner to SyncProgressBanner&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-19-update-client-terminology-cache-to-library>Task 19: Update Client Terminology - Cache to Library<a class=headerlink href=#task-19-update-client-terminology-cache-to-library title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>client/src/components/settings/ServerStatsSection.jsx</code> - Modify: <code>client/src/pages/*.jsx</code> (pages that reference "cache") - Modify: Any other client files with "cache" terminology</p> <p><strong>Step 1: Search for "cache" in user-facing strings</strong></p> <p>Run: <code>cd client &amp;&amp; grep -rn "cache\|Cache" --include="*.jsx" --include="*.tsx" --include="*.js"</code></p> <p><strong>Step 2: Update terminology in each file</strong></p> <p>Replace user-facing strings: - "cache" -&gt; "library" (lowercase) - "Cache" -&gt; "Library" (capitalized) - "loading cache" -&gt; "syncing library" - "refresh cache" -&gt; "sync library" - "cache ready" -&gt; "library ready"</p> <p>Do NOT replace: - Variable names (keep internal code naming) - Technical comments - API endpoint names</p> <p><strong>Step 3: Verify client builds</strong></p> <p>Run: <code>cd client &amp;&amp; npm run build</code> Expected: Build succeeds</p> <p><strong>Step 4: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;refactor: update client terminology from cache to library&quot;</span>
</span></code></pre></div> <hr> <h3 id=task-20-run-linting-and-fix-issues>Task 20: Run Linting and Fix Issues<a class=headerlink href=#task-20-run-linting-and-fix-issues title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - All modified server files - All modified client files</p> <p><strong>Step 1: Run server linting</strong></p> <p>Run: <code>cd server &amp;&amp; npm run lint</code> Expected: No errors (fix any that appear)</p> <p><strong>Step 2: Run client linting</strong></p> <p>Run: <code>cd client &amp;&amp; npm run lint</code> Expected: No errors (fix any that appear)</p> <p><strong>Step 3: Commit any lint fixes</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-77-2><a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;style: fix linting issues&quot;</span><span class=w> </span>--allow-empty
</span></code></pre></div> <hr> <h2 id=session-4-testing-and-documentation>Session 4: Testing and Documentation<a class=headerlink href=#session-4-testing-and-documentation title="Permanent link">&para;</a></h2> <h3 id=task-21-delete-local-database-and-test-fresh-install>Task 21: Delete Local Database and Test Fresh Install<a class=headerlink href=#task-21-delete-local-database-and-test-fresh-install title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Delete: <code>server/prisma/peek.db</code> (local development database)</p> <p><strong>Step 1: Stop the application</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-78-1><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a>docker-compose<span class=w> </span>down
</span></code></pre></div> <p><strong>Step 2: Delete local database</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-79-1><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a>rm<span class=w> </span>-f<span class=w> </span>server/prisma/peek.db<span class=w> </span>server/prisma/peek.db-journal
</span></code></pre></div> <p><strong>Step 3: Start fresh</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-80-1><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a>docker-compose<span class=w> </span>up<span class=w> </span>--build
</span></code></pre></div> <p><strong>Step 4: Verify migrations run</strong></p> <p>Check logs for: "Applied migration: 20251211000000_stash_entities"</p> <p><strong>Step 5: Verify app starts correctly</strong></p> <p>Open http://localhost:5173 and verify the setup wizard appears (fresh install).</p> <hr> <h3 id=task-22-run-all-tests>Task 22: Run All Tests<a class=headerlink href=#task-22-run-all-tests title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - All test files</p> <p><strong>Step 1: Run server tests</strong></p> <p>Run: <code>cd server &amp;&amp; npm test</code> Expected: All non-skipped tests pass</p> <p><strong>Step 2: Run client tests</strong></p> <p>Run: <code>cd client &amp;&amp; npm test</code> Expected: All tests pass</p> <p><strong>Step 3: Fix any failing tests</strong></p> <p>If tests fail, update them to match new naming/structure.</p> <p><strong>Step 4: Commit test fixes</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-81-1><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-81-2><a id=__codelineno-81-2 name=__codelineno-81-2 href=#__codelineno-81-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;test: fix tests for refactored schema&quot;</span><span class=w> </span>--allow-empty
</span></code></pre></div> <hr> <h3 id=task-23-update-readme-documentation>Task 23: Update README Documentation<a class=headerlink href=#task-23-update-readme-documentation title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - Modify: <code>README.md</code> - Modify: <code>CLAUDE.md</code> (if needed)</p> <p><strong>Step 1: Update any cache references in README</strong></p> <p>Search for "cache" in README.md and update user-facing terminology to "library" where appropriate.</p> <p><strong>Step 2: Update CLAUDE.md if terminology changed</strong></p> <p>Search for outdated terminology and update.</p> <p><strong>Step 3: Commit</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-82-1><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a>git<span class=w> </span>add<span class=w> </span>README.md<span class=w> </span>CLAUDE.md
</span><span id=__span-82-2><a id=__codelineno-82-2 name=__codelineno-82-2 href=#__codelineno-82-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;docs: update terminology in documentation&quot;</span><span class=w> </span>--allow-empty
</span></code></pre></div> <hr> <h3 id=task-24-final-verification-and-cleanup>Task 24: Final Verification and Cleanup<a class=headerlink href=#task-24-final-verification-and-cleanup title="Permanent link">&para;</a></h3> <p><strong>Files:</strong> - All project files</p> <p><strong>Step 1: Search for any remaining old references</strong></p> <p>Run from project root: <div class="language-bash highlight"><pre><span></span><code><span id=__span-83-1><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a>grep<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;CachedScene\|CachedPerformer\|CachedStudio\|CachedTag\|CachedGroup\|CachedGallery\|CachedImage\|CachedEntityQueryService\|cachedEntityQueryService\|pathMapping&quot;</span><span class=w> </span>--include<span class=o>=</span><span class=s2>&quot;*.ts&quot;</span><span class=w> </span>--include<span class=o>=</span><span class=s2>&quot;*.tsx&quot;</span><span class=w> </span>--include<span class=o>=</span><span class=s2>&quot;*.js&quot;</span><span class=w> </span>--include<span class=o>=</span><span class=s2>&quot;*.jsx&quot;</span><span class=w> </span>server/<span class=w> </span>client/
</span></code></pre></div></p> <p>Expected: No results</p> <p><strong>Step 2: Verify Docker build works</strong></p> <p>Run: <code>docker-compose build</code> Expected: Build succeeds</p> <p><strong>Step 3: Full application test</strong></p> <p>Run: <code>docker-compose up -d</code> - Verify API endpoints respond - Verify sync runs - Verify scene list loads - Verify performer list loads - Verify search works</p> <p><strong>Step 4: Commit any final fixes</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-84-1><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a>git<span class=w> </span>add<span class=w> </span>-A
</span><span id=__span-84-2><a id=__codelineno-84-2 name=__codelineno-84-2 href=#__codelineno-84-2></a>git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;chore: final cleanup for schema refactor&quot;</span><span class=w> </span>--allow-empty
</span></code></pre></div> <hr> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p><strong>Total Tasks:</strong> 24</p> <p><strong>Breaking Changes:</strong> - Database tables renamed (Cached* -&gt; Stash*) - <code>pathMapping.ts</code> renamed to <code>stashUrlProxy.ts</code> - <code>CachedEntityQueryService</code> renamed to <code>StashEntityService</code> - Denormalized count fields removed (computed via JOINs now) - <code>tagIds</code> JSON fields removed (use junction tables) - <code>data</code> JSON blob field removed</p> <p><strong>Migration Strategy:</strong> - All 6 incremental migrations squashed into single <code>20251211000000_stash_entities</code> migration - Users with existing databases will need to either: 1. Delete database and re-sync (recommended for beta users) 2. Wait for data migration script (if needed for production)</p> <p><strong>Testing:</strong> - Run all unit tests - Run fresh install test - Run full application test with Docker</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 carrotwaxr </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/carrotwaxr/peek-stash-browser target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://hub.docker.com/r/carrotwaxr/peek-stash-browser target=_blank rel=noopener title=hub.docker.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.e71a0d61.min.js></script> <script src=../../javascripts/extra.js></script> </body> </html>